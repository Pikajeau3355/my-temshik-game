<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>UA Temshik: Ultimate Edition</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Manrope:wght@300;500;700;800&display=swap');
        
        :root {
            --primary: #5d5fef; --accent: #a5a6f6; --gold: #ffcf52;
            --bg: #0b0c10; --card-bg: #1c1d26;
            --success: #4ade80; --danger: #f87171;
            --energy-color: #00f2ff;
        }

        body {
            margin: 0; background: var(--bg); color: #ffffff;
            font-family: 'Manrope', sans-serif; overflow: hidden;
            height: 100vh; display: flex; flex-direction: column;
        }

        .police-raid { animation: raid-blink 0.3s infinite; }
        @keyframes raid-blink { 0% { background: var(--bg); } 50% { background: #4b0000; } }

        /* Header */
        .profile-header {
            padding: 50px 20px 15px;
            background: linear-gradient(180deg, rgba(93, 95, 239, 0.15) 0%, rgba(11, 12, 16, 0) 100%);
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .user-info { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; }
        .avatar { width: 50px; height: 50px; background: var(--primary); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 22px; font-weight: 800; box-shadow: 0 0 20px rgba(93,95,239,0.4); }
        
        .balance-card { background: rgba(255, 255, 255, 0.03); border-radius: 24px; padding: 20px; border: 1px solid rgba(255,255,255,0.08); text-align: center; }
        .bal-amount { font-size: 32px; font-weight: 800; letter-spacing: -1px; }
        .bal-amount span { color: var(--gold); margin-left: 5px; }

        .energy-container { margin-top: 15px; }
        .energy-bar-outer { width: 100%; height: 8px; background: rgba(255,255,255,0.05); border-radius: 10px; overflow: hidden; }
        .energy-bar-inner { height: 100%; background: var(--energy-color); width: 100%; transition: 0.3s; box-shadow: 0 0 10px var(--energy-color); }

        /* Viewport */
        .viewport { flex: 1; overflow-y: auto; padding: 15px; padding-bottom: 120px; }
        .tab { display: none; }
        .tab.active { display: block; }
        .section-title { font-size: 12px; font-weight: 800; color: #555; margin: 20px 0 10px; text-transform: uppercase; letter-spacing: 1.5px; display: flex; align-items: center; gap: 8px; }

        /* Cards & Buttons */
        .card { background: var(--card-bg); border-radius: 20px; padding: 16px; margin-bottom: 12px; border: 1px solid rgba(255,255,255,0.03); display: flex; justify-content: space-between; align-items: center; transition: 0.2s; }
        .card:active { transform: scale(0.98); background: rgba(255,255,255,0.05); }
        .card-info h3 { margin: 0; font-size: 15px; font-weight: 700; }
        .card-info p { margin: 4px 0 0; font-size: 12px; color: #828282; }
        
        .btn { background: var(--primary); color: white; border: none; padding: 10px 18px; border-radius: 14px; font-weight: 800; font-size: 12px; transition: 0.3s; }
        .btn:disabled { background: #333; color: #666; }

        /* Journal/Terminal */
        #terminal { background: rgba(0,0,0,0.3); border-radius: 15px; padding: 12px; font-family: 'Courier New', monospace; font-size: 11px; height: 100px; overflow-y: auto; border: 1px solid rgba(255,255,255,0.05); margin-bottom: 20px; }
        .log-entry { margin-bottom: 4px; border-left: 2px solid var(--primary); padding-left: 8px; animation: fadeIn 0.3s; }

        /* Leaderboard */
        .leader-item { background: var(--card-bg); border-radius: 16px; padding: 14px; margin-bottom: 8px; display: flex; align-items: center; gap: 12px; }
        .leader-item.me { border: 1px solid var(--primary); background: rgba(93, 95, 239, 0.1); }

        /* Nav */
        .nav { position: fixed; bottom: 20px; left: 15px; right: 15px; background: rgba(28, 29, 38, 0.95); backdrop-filter: blur(10px); border-radius: 24px; height: 70px; display: flex; justify-content: space-around; align-items: center; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: #555; font-size: 10px; font-weight: 700; gap: 4px; }
        .nav-item.active { color: var(--primary); }
        .nav-item span { font-size: 20px; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body id="main-body">

    <div class="profile-header">
        <div class="user-info">
            <div class="avatar" id="user-avatar">?</div>
            <div class="user-text">
                <h2 id="user-name" style="margin:0; font-size:18px;">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</h2>
                <p id="user-rank" style="margin:2px 0 0; font-size:11px; color:var(--gold);">–†—ñ–≤–µ–Ω—å 1 ‚Ä¢ –ù–æ–≤–∞—á–æ–∫</p>
            </div>
        </div>
        <div class="balance-card">
            <div class="bal-amount" id="balance">0<span>‚Ç¥</span></div>
            <div style="font-size:12px; color:var(--success); font-weight: 700; margin-top:5px;" id="passive-info">+0 ‚Ç¥/—Å–µ–∫</div>
            <div class="energy-container">
                <div class="energy-bar-outer"><div class="energy-bar-inner" id="energy-bar"></div></div>
                <div style="display:flex; justify-content:space-between; font-size:10px; margin-top:5px; color:#666;">
                    <span>–ï–ù–ï–†–ì–Ü–Ø</span><span id="energy-text">100/100</span>
                </div>
            </div>
        </div>
    </div>

    <div class="viewport">
        <div id="tab-work" class="tab active">
            <div id="terminal">
                <div class="log-entry" style="border-color:var(--gold)">–°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–∞. –ß–µ–∫–∞—î–º–æ –Ω–∞ —Ç–µ–º–∫–∏...</div>
            </div>

            <div class="section-title">üí∏ –õ–µ–≥–∞–ª—å–Ω—ñ —Å—Ö–µ–º–∏</div>
            <div id="temki-list">
                <div class="card">
                    <div class="card-info"><h3>–î—Ä–æ–ø –Ω–∞ –ü—Ä–æ–º</h3><p>–ü—Ä–∏–±—É—Ç–æ–∫: ~500‚Ç¥ | –ï–Ω–µ—Ä–≥—ñ—è: -15</p></div>
                    <button class="btn" onclick="doWork('–ü—Ä–æ–º', 500, 15, 25)">–í–û–†–í–ê–¢–ò–°–¨</button>
                </div>
                <div class="card">
                    <div class="card-info"><h3>–ü–µ—Ä–µ–ø—Ä–æ–¥–∞–∂ –∞–≤—Ç–æ</h3><p>–ü—Ä–∏–±—É—Ç–æ–∫: ~2500‚Ç¥ | –ï–Ω–µ—Ä–≥—ñ—è: -40</p></div>
                    <button class="btn" onclick="doWork('–ê–≤—Ç–æ', 2500, 40, 80)">–ú–£–¢–ò–¢–ò</button>
                </div>
            </div>

            <div class="section-title">üö® –¢—ñ–Ω—å–æ–≤–∏–π —Å–µ–∫—Ç–æ—Ä</div>
            <div id="crime-list">
                <div class="card">
                    <div class="card-info"><h3>–§—ñ—à–∏–Ω–≥ –ø–æ—Å–∏–ª–∞–Ω–Ω—è</h3><p>–†–∏–∑–∏–∫ 40% | –ü—Ä–∏–±—É—Ç–æ–∫ –¥–æ 20–∫</p></div>
                    <button class="btn" style="background:var(--danger)" onclick="doCrime('–§—ñ—à–∏–Ω–≥', 20000, 35)">–†–ò–ó–ò–ö–ù–£–¢–ò</button>
                </div>
            </div>
        </div>

        <div id="tab-crypto" class="tab">
            <div class="section-title">üìà Bitcoin (BTC/UAH)</div>
            <div class="card" style="flex-direction: column; align-items: flex-start;">
                <div id="btc-price" style="font-size: 26px; font-weight: 800; color: var(--success);">‚Ç¥ 3,850,200</div>
                <canvas id="cryptoChart" style="width:100%; height:100px; margin-top:15px;"></canvas>
            </div>
            <div class="card">
                <div class="card-info"><h3>–¢–≤—ñ–π –≥–∞–º–∞–Ω–µ—Ü—å</h3><p id="my-btc">0.000000 BTC</p></div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                <button class="btn" onclick="trade('buy')" style="background:var(--success); padding: 15px;">–ö–£–ü–ò–¢–ò (MAX)</button>
                <button class="btn" onclick="trade('sell')" style="background:var(--danger); padding: 15px;">–ü–†–û–î–ê–¢–ò (ALL)</button>
            </div>
        </div>

        <div id="tab-shop" class="tab">
            <div class="section-title">üè¢ –¢–≤—ñ–π –ë—ñ–∑–Ω–µ—Å (–ü–∞—Å–∏–≤–Ω–∏–π –¥–æ—Ö—ñ–¥)</div>
            <div id="assets-list"></div>
            
            <div class="section-title">üèéÔ∏è –ê–≤—Ç–æ—Å–∞–ª–æ–Ω (–ë–æ–Ω—É—Å–∏)</div>
            <div id="garage-list"></div>
        </div>

        <div id="tab-top" class="tab">
            <div class="section-title">üèÜ –¢–û–ü-10 –¢–µ–º—â–∏–∫—ñ–≤ –£–∫—Ä–∞—ó–Ω–∏</div>
            <div id="leader-list"></div>
        </div>
    </div>

    <nav class="nav">
        <div class="nav-item active" onclick="showTab('work', this)"><span>üí∞</span>–¢–µ–º–∫–∏</div>
        <div class="nav-item" onclick="showTab('crypto', this)"><span>üìä</span>–ë—ñ—Ä–∂–∞</div>
        <div class="nav-item" onclick="showTab('shop', this)"><span>üè¢</span>–®–æ–ø</div>
        <div class="nav-item" onclick="showTab('top', this)"><span>üèÜ</span>–¢–û–ü</div>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        const firebaseConfig = {
            apiKey: "AIzaSyA1m-re7gnHR6zxSoPdy3T0_2jX3IRzgJ4",
            authDomain: "temshiki.firebaseapp.com",
            databaseURL: "https://temshiki-default-rtdb.firebaseio.com",
            projectId: "temshiki",
            storageBucket: "temshiki.firebasestorage.app",
            messagingSenderId: "806405354510",
            appId: "1:806405354510:web:828cb6aae403df3cc0f85f"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Game State
        let money = Number(localStorage.getItem('money')) || 10000;
        let btc = Number(localStorage.getItem('btc')) || 0;
        let energy = 100;
        let xp = Number(localStorage.getItem('xp')) || 0;
        let btcPrice = 3800000;
        let priceHistory = [3700000, 3750000, 3800000, 3780000, 3820000];
        let myGarage = JSON.parse(localStorage.getItem('myGarage')) || [];
        let myAssets = JSON.parse(localStorage.getItem('myAssets')) || { bot: 0, farm: 0, office: 0 };

        const carData = [
            { id: 'lanos', name: "Lanos Turbo", cost: 150000, bonus: "+2 –µ–Ω–µ—Ä–≥—ñ—ó/—Ö–≤" },
            { id: 'camry', name: "Camry 70", cost: 1200000, bonus: "-15% —Ä–∏–∑–∏–∫—É" },
            { id: 'm5', name: "BMW M5 F90", cost: 5500000, bonus: "+50% XP" }
        ];

        const bizData = [
            { id: 'bot', name: "–¢–ì –ë–æ—Ç-–æ–±–º—ñ–Ω–Ω–∏–∫", cost: 15000, income: 15 },
            { id: 'farm', name: "–ú–∞–π–Ω—ñ–Ω–≥ –§–µ—Ä–º–∞", cost: 150000, income: 180 },
            { id: 'office', name: "–û—Ñ—ñ—Å –≤ —Ü–µ–Ω—Ç—Ä—ñ", cost: 2000000, income: 2500 }
        ];

        function addLog(text, color = 'white') {
            const term = document.getElementById('terminal');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.style.borderColor = color === 'white' ? 'var(--primary)' : color;
            entry.innerHTML = `<span style="color:#666">[${new Date().toLocaleTimeString()}]</span> ${text}`;
            term.prepend(entry);
            if(term.childNodes.length > 15) term.lastChild.remove();
        }

        function updateUI() {
            document.getElementById('balance').innerHTML = Math.floor(money).toLocaleString() + '<span>‚Ç¥</span>';
            document.getElementById('energy-bar').style.width = energy + '%';
            document.getElementById('energy-text').textContent = `${Math.floor(energy)}/100`;
            document.getElementById('my-btc').textContent = btc.toFixed(6) + ' BTC';
            
            let level = Math.floor(xp / 1000) + 1;
            document.getElementById('user-rank').textContent = `–†—ñ–≤–µ–Ω—å ${level} ‚Ä¢ ${level > 5 ? '–ú–∞–≥–Ω–∞—Ç' : '–ù–æ–≤–∞—á–æ–∫'}`;
            document.getElementById('user-name').textContent = tg.initDataUnsafe?.user?.first_name || "–ì—Ä–∞–≤–µ—Ü—å";
            document.getElementById('user-avatar').textContent = (tg.initDataUnsafe?.user?.first_name || "T")[0].toUpperCase();

            let passive = (myAssets.bot * 15) + (myAssets.farm * 180) + (myAssets.office * 2500);
            document.getElementById('passive-info').textContent = `+${passive.toLocaleString()} ‚Ç¥/—Å–µ–∫`;

            renderLists();
            save();
        }

        function renderLists() {
            // –®–æ–ø: –ë—ñ–∑–Ω–µ—Å–∏
            let assetHtml = '';
            bizData.forEach(b => {
                assetHtml += `<div class="card">
                    <div class="card-info"><h3>${b.name} (${myAssets[b.id]})</h3><p>–¶—ñ–Ω–∞: ${b.cost.toLocaleString()} ‚Ç¥ | –î–æ—Ö—ñ–¥: +${b.income} ‚Ç¥/—Å</p></div>
                    <button class="btn" onclick="buyAsset('${b.id}', ${b.cost})" ${money < b.cost ? 'disabled' : ''}>–ö–£–ü–ò–¢–ò</button>
                </div>`;
            });
            document.getElementById('assets-list').innerHTML = assetHtml;

            // –®–æ–ø: –ê–≤—Ç–æ
            let garageHtml = '';
            carData.forEach(c => {
                let has = myGarage.includes(c.id);
                garageHtml += `<div class="card">
                    <div class="card-info"><h3>${c.name}</h3><p>${c.cost.toLocaleString()} ‚Ç¥ | ${c.bonus}</p></div>
                    <button class="btn" onclick="buyCar('${c.id}', ${c.cost})" ${ (money < c.cost || has) ? 'disabled' : ''}>${has ? '–ö–£–ü–õ–ï–ù–û' : '–ö–£–ü–ò–¢–ò'}</button>
                </div>`;
            });
            document.getElementById('garage-list').innerHTML = garageHtml;
        }

        function doWork(name, p, e, x) {
            if(energy >= e) {
                let profit = p + Math.floor(Math.random() * (p * 0.5));
                money += profit; energy -= e; xp += x;
                addLog(`–°—Ö–µ–º–∞ "${name}" —É—Å–ø—ñ—à–Ω–∞: +${profit} ‚Ç¥`, 'var(--success)');
                tg.HapticFeedback.impactOccurred('medium');
                updateUI();
            } else {
                addLog("–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –µ–Ω–µ—Ä–≥—ñ—ó!", 'var(--danger)');
            }
        }

        function doCrime(name, max, e) {
            if(energy >= e) {
                energy -= e;
                let riskBase = myGarage.includes('camry') ? 0.25 : 0.4;
                if(Math.random() > riskBase) {
                    let profit = Math.floor(Math.random() * max);
                    money += profit; xp += 150;
                    addLog(`–ö—Ä–∏–º—ñ–Ω–∞–ª "${name}" –≤–¥–∞–≤—Å—è: +${profit} ‚Ç¥`, 'var(--gold)');
                    tg.HapticFeedback.notificationOccurred('success');
                } else {
                    let fine = Math.floor(money * 0.2);
                    money -= fine;
                    document.getElementById('main-body').classList.add('police-raid');
                    setTimeout(() => document.getElementById('main-body').classList.remove('police-raid'), 1000);
                    addLog(`–û–ë–õ–ê–í–ê! –ü–æ–ª—ñ—Ü—ñ—è –≤–∏–ª—É—á–∏–ª–∞ ${fine} ‚Ç¥`, 'var(--danger)');
                    tg.HapticFeedback.notificationOccurred('error');
                }
                updateUI();
            }
        }

        function trade(type) {
            if(type === 'buy' && money > 100) { btc += money / btcPrice; money = 0; addLog("–ö—É–ø–ª–µ–Ω–æ BTC –Ω–∞ –≤—Å—ñ –≥—Ä–æ—à—ñ", 'var(--success)'); }
            else if(type === 'sell' && btc > 0) { money += btc * btcPrice; btc = 0; addLog("–í—Å—è –∫—Ä–∏–ø—Ç–∞ –ø—Ä–æ–¥–∞–Ω–∞", 'var(--gold)'); }
            updateUI();
        }

        function buyAsset(id, cost) { if(money >= cost) { money -= cost; myAssets[id]++; addLog(`–ö—É–ø–ª–µ–Ω–æ –±—ñ–∑–Ω–µ—Å!`, 'var(--success)'); updateUI(); } }
        function buyCar(id, cost) { if(money >= cost) { money -= cost; myGarage.push(id); addLog(`–ù–æ–≤–µ –∞–≤—Ç–æ –≤ –≥–∞—Ä–∞–∂—ñ!`, 'var(--success)'); updateUI(); } }

        function showTab(name, el) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('tab-' + name).classList.add('active');
            el.classList.add('active');
            if(name === 'top') loadTop();
            if(name === 'crypto') setTimeout(drawChart, 100);
        }

        function loadTop() {
            database.ref('users').orderByChild('balance').limitToLast(10).on('value', (s) => {
                let l = document.getElementById('leader-list'); l.innerHTML = '';
                let players = []; s.forEach(c => { players.push({id: c.key, ...c.val()}); });
                players.reverse().forEach((p, i) => {
                    const isMe = p.id == (tg.initDataUnsafe?.user?.id || "dev_user");
                    l.innerHTML += `<div class="leader-item ${isMe?'me':''}">
                        <b style="color:var(--gold)">#${i+1}</b> <span style="flex:1">${p.name} (Lvl ${p.lvl})</span> 
                        <span style="color:var(--success); font-weight:800">${Math.floor(p.balance).toLocaleString()} ‚Ç¥</span>
                    </div>`;
                });
            });
        }

        function drawChart() {
            const canvas = document.getElementById('cryptoChart'); if(!canvas) return;
            const ctx = canvas.getContext('2d'); ctx.clearRect(0,0,canvas.width,canvas.height);
            ctx.beginPath(); ctx.strokeStyle = '#4ade80'; ctx.lineWidth = 4;
            priceHistory.forEach((p, i) => {
                let x = (i / (priceHistory.length-1)) * canvas.width;
                let y = canvas.height - ((p - 3000000) / 2000000) * canvas.height;
                if(i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
            });
            ctx.stroke();
        }

        function save() {
            localStorage.setItem('money', money);
            localStorage.setItem('btc', btc);
            localStorage.setItem('xp', xp);
            localStorage.setItem('myGarage', JSON.stringify(myGarage));
            localStorage.setItem('myAssets', JSON.stringify(myAssets));
            
            const uid = tg.initDataUnsafe?.user?.id || "dev_user";
            database.ref('users/' + uid).set({
                name: tg.initDataUnsafe?.user?.first_name || "–¢–µ–º—â–∏–∫",
                balance: Math.floor(money + (btc * btcPrice)),
                lvl: Math.floor(xp / 1000) + 1
            });
        }

        setInterval(() => {
            btcPrice += (Math.random() - 0.5) * 60000;
            priceHistory.push(btcPrice); if(priceHistory.length > 30) priceHistory.shift();
            if(document.getElementById('tab-crypto').classList.contains('active')) {
                document.getElementById('btc-price').textContent = '‚Ç¥ ' + Math.floor(btcPrice).toLocaleString();
                drawChart();
            }
            if(energy < 100) energy = Math.min(100, energy + (myGarage.includes('lanos') ? 1.5 : 0.8));
            money += (myAssets.bot * 15 + myAssets.farm * 180 + myAssets.office * 2500) / 10;
            updateUI();
        }, 3000);

        updateUI();
    </script>
</body>
</html>
