<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>–í—ã–∂–∏–≤–∞–Ω–∏–µ | Survival</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #e8e8e8;
            overflow-x: hidden;
        }
        
        .font-orbitron {
            font-family: 'Orbitron', monospace;
        }
        
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .glow-green {
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.3);
        }
        
        .glow-red {
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
        }
        
        .glow-blue {
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
        }
        
        .glow-yellow {
            box-shadow: 0 0 20px rgba(234, 179, 8, 0.3);
        }
        
        .stat-bar {
            height: 8px;
            border-radius: 4px;
            background: rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }
        
        .stat-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease, background-color 0.3s ease;
        }
        
        .action-btn {
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }
        
        .action-btn:active {
            transform: scale(0.95);
        }
        
        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .action-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.3s, height 0.3s;
        }
        
        .action-btn:active::after {
            width: 200px;
            height: 200px;
        }
        
        .inventory-item {
            transition: all 0.2s ease;
        }
        
        .inventory-item:hover {
            transform: translateY(-2px);
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .event-notification {
            animation: slideIn 0.3s ease, slideOut 0.3s ease 2.7s forwards;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        .weather-icon {
            font-size: 2rem;
        }
        
        .tab-active {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
        }
        
        ::-webkit-scrollbar {
            width: 4px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(34, 197, 94, 0.5);
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <div id="app" class="min-h-screen pb-20">
        <!-- Header -->
        <header class="glass sticky top-0 z-50 px-4 py-3">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                    <div class="text-2xl">üèïÔ∏è</div>
                    <div>
                        <h1 class="font-orbitron font-bold text-lg text-green-400">–í–´–ñ–ò–í–ê–ù–ò–ï</h1>
                        <p class="text-xs text-gray-400">–î–µ–Ω—å <span id="day-counter" class="text-yellow-400 font-bold">1</span></p>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <div id="weather-display" class="weather-icon">‚òÄÔ∏è</div>
                    <div class="text-right">
                        <p class="text-xs text-gray-400">–í—Ä–µ–º—è</p>
                        <p id="time-display" class="font-orbitron text-sm text-blue-400">06:00</p>
                    </div>
                </div>
            </div>
        </header>

        <!-- Stats Section -->
        <section class="px-4 py-4">
            <div class="glass rounded-2xl p-4 space-y-3">
                <!-- Health -->
                <div class="flex items-center gap-3">
                    <div class="text-xl w-8 text-center">‚ù§Ô∏è</div>
                    <div class="flex-1">
                        <div class="flex justify-between text-xs mb-1">
                            <span class="text-gray-400">–ó–¥–æ—Ä–æ–≤—å–µ</span>
                            <span id="health-value" class="text-red-400 font-bold">100%</span>
                        </div>
                        <div class="stat-bar">
                            <div id="health-bar" class="stat-fill bg-gradient-to-r from-red-600 to-red-400" style="width: 100%"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Hunger -->
                <div class="flex items-center gap-3">
                    <div class="text-xl w-8 text-center">üçñ</div>
                    <div class="flex-1">
                        <div class="flex justify-between text-xs mb-1">
                            <span class="text-gray-400">–°—ã—Ç–æ—Å—Ç—å</span>
                            <span id="hunger-value" class="text-orange-400 font-bold">100%</span>
                        </div>
                        <div class="stat-bar">
                            <div id="hunger-bar" class="stat-fill bg-gradient-to-r from-orange-600 to-orange-400" style="width: 100%"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Thirst -->
                <div class="flex items-center gap-3">
                    <div class="text-xl w-8 text-center">üíß</div>
                    <div class="flex-1">
                        <div class="flex justify-between text-xs mb-1">
                            <span class="text-gray-400">–ñ–∞–∂–¥–∞</span>
                            <span id="thirst-value" class="text-blue-400 font-bold">100%</span>
                        </div>
                        <div class="stat-bar">
                            <div id="thirst-bar" class="stat-fill bg-gradient-to-r from-blue-600 to-blue-400" style="width: 100%"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Energy -->
                <div class="flex items-center gap-3">
                    <div class="text-xl w-8 text-center">‚ö°</div>
                    <div class="flex-1">
                        <div class="flex justify-between text-xs mb-1">
                            <span class="text-gray-400">–≠–Ω–µ—Ä–≥–∏—è</span>
                            <span id="energy-value" class="text-yellow-400 font-bold">100%</span>
                        </div>
                        <div class="stat-bar">
                            <div id="energy-bar" class="stat-fill bg-gradient-to-r from-yellow-600 to-yellow-400" style="width: 100%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tab Navigation -->
        <section class="px-4 mb-4">
            <div class="glass rounded-xl p-1 flex gap-1">
                <button onclick="switchTab('actions')" id="tab-actions" class="tab-active flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all">
                    ‚öîÔ∏è –î–µ–π—Å—Ç–≤–∏—è
                </button>
                <button onclick="switchTab('inventory')" id="tab-inventory" class="flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all text-gray-400 hover:text-white">
                    üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å
                </button>
                <button onclick="switchTab('crafting')" id="tab-crafting" class="flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all text-gray-400 hover:text-white">
                    üî® –ö—Ä–∞—Ñ—Ç
                </button>
            </div>
        </section>

        <!-- Actions Tab -->
        <section id="panel-actions" class="px-4 space-y-3">
            <div class="grid grid-cols-2 gap-3">
                <button onclick="doAction('explore')" class="action-btn glass rounded-xl p-4 text-left glow-green">
                    <div class="text-3xl mb-2">üå≤</div>
                    <h3 class="font-bold text-green-400">–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å</h3>
                    <p class="text-xs text-gray-400 mt-1">-10 ‚ö° | –ù–∞–π—Ç–∏ —Ä–µ—Å—É—Ä—Å—ã</p>
                </button>
                
                <button onclick="doAction('hunt')" class="action-btn glass rounded-xl p-4 text-left glow-red">
                    <div class="text-3xl mb-2">üèπ</div>
                    <h3 class="font-bold text-red-400">–û—Ö–æ—Ç–∏—Ç—å—Å—è</h3>
                    <p class="text-xs text-gray-400 mt-1">-20 ‚ö° | –î–æ–±—ã—Ç—å –µ–¥—É</p>
                </button>
                
                <button onclick="doAction('gather_water')" class="action-btn glass rounded-xl p-4 text-left glow-blue">
                    <div class="text-3xl mb-2">üèûÔ∏è</div>
                    <h3 class="font-bold text-blue-400">–ö —Ä–µ–∫–µ</h3>
                    <p class="text-xs text-gray-400 mt-1">-15 ‚ö° | –ù–∞–±—Ä–∞—Ç—å –≤–æ–¥—ã</p>
                </button>
                
                <button onclick="doAction('rest')" class="action-btn glass rounded-xl p-4 text-left glow-yellow">
                    <div class="text-3xl mb-2">üèïÔ∏è</div>
                    <h3 class="font-bold text-yellow-400">–û—Ç–¥–æ—Ö–Ω—É—Ç—å</h3>
                    <p class="text-xs text-gray-400 mt-1">+30 ‚ö° | 2 —á–∞—Å–∞</p>
                </button>
            </div>
            
            <div class="grid grid-cols-2 gap-3">
                <button onclick="doAction('eat')" class="action-btn glass rounded-xl p-3 flex items-center gap-3">
                    <div class="text-2xl">üçñ</div>
                    <div class="text-left">
                        <h3 class="font-bold text-sm">–ü–æ–µ—Å—Ç—å</h3>
                        <p class="text-xs text-gray-400">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–¥—É</p>
                    </div>
                </button>
                
                <button onclick="doAction('drink')" class="action-btn glass rounded-xl p-3 flex items-center gap-3">
                    <div class="text-2xl">ü•§</div>
                    <div class="text-left">
                        <h3 class="font-bold text-sm">–ü–æ–ø–∏—Ç—å</h3>
                        <p class="text-xs text-gray-400">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–æ–¥—É</p>
                    </div>
                </button>
            </div>
            
            <button onclick="doAction('sleep')" class="action-btn w-full glass rounded-xl p-4 flex items-center justify-center gap-3 border border-purple-500/30">
                <div class="text-2xl">üò¥</div>
                <div class="text-left">
                    <h3 class="font-bold text-purple-400">–°–ø–∞—Ç—å –¥–æ —É—Ç—Ä–∞</h3>
                    <p class="text-xs text-gray-400">–ü–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏</p>
                </div>
            </button>
        </section>

        <!-- Inventory Tab -->
        <section id="panel-inventory" class="px-4 hidden">
            <div class="glass rounded-2xl p-4">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="font-orbitron font-bold text-lg">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2>
                    <span id="inventory-count" class="text-sm text-gray-400">0/20</span>
                </div>
                <div id="inventory-grid" class="grid grid-cols-4 gap-2">
                    <!-- Items will be added here dynamically -->
                </div>
                <div id="empty-inventory" class="text-center py-8 text-gray-500">
                    <div class="text-4xl mb-2">üéí</div>
                    <p>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç</p>
                    <p class="text-sm">–ò—Å—Å–ª–µ–¥—É–π—Ç–µ –º–∏—Ä, —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ —Ä–µ—Å—É—Ä—Å—ã</p>
                </div>
            </div>
        </section>

        <!-- Crafting Tab -->
        <section id="panel-crafting" class="px-4 hidden">
            <div class="space-y-3">
                <div class="glass rounded-xl p-4">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="text-3xl">üî•</div>
                        <div>
                            <h3 class="font-bold">–ö–æ—Å—Ç—ë—Ä</h3>
                            <p class="text-xs text-gray-400">–ì–æ—Ç–æ–≤–∏—Ç—å –µ–¥—É, –≥—Ä–µ—Ç—å—Å—è</p>
                        </div>
                    </div>
                    <div class="flex items-center justify-between">
                        <div class="text-sm text-gray-400">
                            <span class="text-orange-400">ü™µ x3</span> + <span class="text-gray-400">ü™® x2</span>
                        </div>
                        <button onclick="craft('campfire')" class="action-btn bg-gradient-to-r from-orange-600 to-red-600 px-4 py-2 rounded-lg text-sm font-bold">
                            –°–æ–∑–¥–∞—Ç—å
                        </button>
                    </div>
                </div>
                
                <div class="glass rounded-xl p-4">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="text-3xl">üè†</div>
                        <div>
                            <h3 class="font-bold">–£–∫—Ä—ã—Ç–∏–µ</h3>
                            <p class="text-xs text-gray-400">–ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ–ø–æ–≥–æ–¥—ã</p>
                        </div>
                    </div>
                    <div class="flex items-center justify-between">
                        <div class="text-sm text-gray-400">
                            <span class="text-orange-400">ü™µ x10</span> + <span class="text-green-400">üåø x5</span>
                        </div>
                        <button onclick="craft('shelter')" class="action-btn bg-gradient-to-r from-green-600 to-emerald-600 px-4 py-2 rounded-lg text-sm font-bold">
                            –°–æ–∑–¥–∞—Ç—å
                        </button>
                    </div>
                </div>
                
                <div class="glass rounded-xl p-4">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="text-3xl">üó°Ô∏è</div>
                        <div>
                            <h3 class="font-bold">–ö–æ–ø—å—ë</h3>
                            <p class="text-xs text-gray-400">–£–ª—É—á—à–∞–µ—Ç –æ—Ö–æ—Ç—É</p>
                        </div>
                    </div>
                    <div class="flex items-center justify-between">
                        <div class="text-sm text-gray-400">
                            <span class="text-orange-400">ü™µ x2</span> + <span class="text-gray-400">ü™® x1</span>
                        </div>
                        <button onclick="craft('spear')" class="action-btn bg-gradient-to-r from-gray-600 to-gray-500 px-4 py-2 rounded-lg text-sm font-bold">
                            –°–æ–∑–¥–∞—Ç—å
                        </button>
                    </div>
                </div>
                
                <div class="glass rounded-xl p-4">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="text-3xl">üß¥</div>
                        <div>
                            <h3 class="font-bold">–§–ª—è–≥–∞</h3>
                            <p class="text-xs text-gray-400">–•—Ä–∞–Ω–∏—Ç—å –±–æ–ª—å—à–µ –≤–æ–¥—ã</p>
                        </div>
                    </div>
                    <div class="flex items-center justify-between">
                        <div class="text-sm text-gray-400">
                            <span class="text-green-400">üåø x3</span> + <span class="text-blue-400">üíß x1</span>
                        </div>
                        <button onclick="craft('flask')" class="action-btn bg-gradient-to-r from-blue-600 to-cyan-600 px-4 py-2 rounded-lg text-sm font-bold">
                            –°–æ–∑–¥–∞—Ç—å
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Event Log -->
        <section class="px-4 mt-4">
            <div class="glass rounded-2xl p-4">
                <h2 class="font-orbitron font-bold text-sm mb-3 text-gray-400">üìú –ñ—É—Ä–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π</h2>
                <div id="event-log" class="space-y-2 max-h-32 overflow-y-auto">
                    <p class="text-sm text-gray-500 fade-in">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∏—Ä –≤—ã–∂–∏–≤–∞–Ω–∏—è!</p>
                </div>
            </div>
        </section>

        <!-- Notifications -->
        <div id="notifications" class="fixed top-20 right-4 space-y-2 z-50"></div>

        <!-- Game Over Modal -->
        <div id="game-over-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
            <div class="glass rounded-2xl p-6 max-w-sm w-full text-center">
                <div class="text-6xl mb-4">üíÄ</div>
                <h2 class="font-orbitron font-bold text-2xl text-red-500 mb-2">–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê</h2>
                <p id="death-reason" class="text-gray-400 mb-4">–í—ã –Ω–µ —Å–º–æ–≥–ª–∏ –≤—ã–∂–∏—Ç—å...</p>
                <div class="glass rounded-xl p-4 mb-4">
                    <p class="text-sm text-gray-400">–í—ã –≤—ã–∂–∏–ª–∏</p>
                    <p class="font-orbitron text-3xl text-yellow-400" id="survived-days">1 –¥–µ–Ω—å</p>
                </div>
                <button onclick="restartGame()" class="w-full action-btn bg-gradient-to-r from-green-600 to-emerald-600 py-3 rounded-xl font-bold text-lg">
                    üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ
                </button>
            </div>
        </div>
    </div>

    <script>
        // Initialize Telegram WebApp
        const tg = window.Telegram?.WebApp;
        if (tg) {
            tg.ready();
            tg.expand();
            tg.setHeaderColor('#1a1a2e');
            tg.setBackgroundColor('#1a1a2e');
        }

        // Game State
        let gameState = {
            day: 1,
            hour: 6,
            health: 100,
            hunger: 100,
            thirst: 100,
            energy: 100,
            inventory: [],
            crafted: {
                campfire: false,
                shelter: false,
                spear: false,
                flask: false
            },
            weather: 'sunny',
            isAlive: true
        };

        // Item definitions
        const items = {
            wood: { name: '–î—Ä–µ–≤–µ—Å–∏–Ω–∞', emoji: 'ü™µ', stackable: true },
            stone: { name: '–ö–∞–º–µ–Ω—å', emoji: 'ü™®', stackable: true },
            plant: { name: '–†–∞—Å—Ç–µ–Ω–∏—è', emoji: 'üåø', stackable: true },
            meat_raw: { name: '–°—ã—Ä–æ–µ –º—è—Å–æ', emoji: 'ü•©', stackable: true },
            meat_cooked: { name: '–ñ–∞—Ä–µ–Ω–æ–µ –º—è—Å–æ', emoji: 'üçñ', stackable: true },
            water: { name: '–í–æ–¥–∞', emoji: 'üíß', stackable: true },
            berries: { name: '–Ø–≥–æ–¥—ã', emoji: 'ü´ê', stackable: true },
            mushroom: { name: '–ì—Ä–∏–±—ã', emoji: 'üçÑ', stackable: true },
            fish: { name: '–†—ã–±–∞', emoji: 'üêü', stackable: true }
        };

        // Weather types
        const weatherTypes = [
            { type: 'sunny', emoji: '‚òÄÔ∏è', effect: 'normal' },
            { type: 'cloudy', emoji: '‚òÅÔ∏è', effect: 'normal' },
            { type: 'rainy', emoji: 'üåßÔ∏è', effect: 'wet' },
            { type: 'stormy', emoji: '‚õàÔ∏è', effect: 'dangerous' },
            { type: 'night', emoji: 'üåô', effect: 'dark' }
        ];

        // Update UI
        function updateUI() {
            // Stats
            document.getElementById('health-value').textContent = Math.round(gameState.health) + '%';
            document.getElementById('health-bar').style.width = gameState.health + '%';
            
            document.getElementById('hunger-value').textContent = Math.round(gameState.hunger) + '%';
            document.getElementById('hunger-bar').style.width = gameState.hunger + '%';
            
            document.getElementById('thirst-value').textContent = Math.round(gameState.thirst) + '%';
            document.getElementById('thirst-bar').style.width = gameState.thirst + '%';
            
            document.getElementById('energy-value').textContent = Math.round(gameState.energy) + '%';
            document.getElementById('energy-bar').style.width = gameState.energy + '%';
            
            // Day and time
            document.getElementById('day-counter').textContent = gameState.day;
            document.getElementById('time-display').textContent = 
                String(gameState.hour).padStart(2, '0') + ':00';
            
            // Weather
            updateWeather();
            
            // Inventory
            updateInventory();
            
            // Color coding for low stats
            updateStatColors();
        }

        function updateStatColors() {
            const healthBar = document.getElementById('health-bar');
            const hungerBar = document.getElementById('hunger-bar');
            const thirstBar = document.getElementById('thirst-bar');
            
            if (gameState.health < 25) healthBar.classList.add('pulse-animation');
            else healthBar.classList.remove('pulse-animation');
            
            if (gameState.hunger < 25) hungerBar.classList.add('pulse-animation');
            else hungerBar.classList.remove('pulse-animation');
            
            if (gameState.thirst < 25) thirstBar.classList.add('pulse-animation');
            else thirstBar.classList.remove('pulse-animation');
        }

        function updateWeather() {
            const hour = gameState.hour;
            let weather;
            
            if (hour >= 21 || hour < 6) {
                weather = weatherTypes[4]; // night
            } else {
                const rand = Math.random();
                if (rand < 0.6) weather = weatherTypes[0];
                else if (rand < 0.8) weather = weatherTypes[1];
                else if (rand < 0.95) weather = weatherTypes[2];
                else weather = weatherTypes[3];
            }
            
            gameState.weather = weather.type;
            document.getElementById('weather-display').textContent = weather.emoji;
        }

        function updateInventory() {
            const grid = document.getElementById('inventory-grid');
            const emptyMsg = document.getElementById('empty-inventory');
            const countEl = document.getElementById('inventory-count');
            
            // Count items
            const itemCounts = {};
            gameState.inventory.forEach(item => {
                itemCounts[item] = (itemCounts[item] || 0) + 1;
            });
            
            const totalItems = gameState.inventory.length;
            countEl.textContent = `${totalItems}/20`;
            
            if (totalItems === 0) {
                grid.innerHTML = '';
                emptyMsg.classList.remove('hidden');
                return;
            }
            
            emptyMsg.classList.add('hidden');
            grid.innerHTML = '';
            
            Object.entries(itemCounts).forEach(([itemId, count]) => {
                const item = items[itemId];
                if (item) {
                    const div = document.createElement('div');
                    div.className = 'inventory-item glass rounded-lg p-2 text-center relative';
                    div.innerHTML = `
                        <div class="text-2xl">${item.emoji}</div>
                        <div class="text-xs text-gray-400 mt-1">${item.name}</div>
                        ${count > 1 ? `<div class="absolute -top-1 -right-1 bg-green-500 text-xs w-5 h-5 rounded-full flex items-center justify-center font-bold">${count}</div>` : ''}
                    `;
                    grid.appendChild(div);
                }
            });
        }

        // Switch tabs
        function switchTab(tab) {
            ['actions', 'inventory', 'crafting'].forEach(t => {
                document.getElementById(`panel-${t}`).classList.add('hidden');
                document.getElementById(`tab-${t}`).classList.remove('tab-active');
                document.getElementById(`tab-${t}`).classList.add('text-gray-400');
            });
            
            document.getElementById(`panel-${tab}`).classList.remove('hidden');
            document.getElementById(`tab-${tab}`).classList.add('tab-active');
            document.getElementById(`tab-${tab}`).classList.remove('text-gray-400');
        }

        // Add to log
        function addLog(message, type = 'normal') {
            const log = document.getElementById('event-log');
            const p = document.createElement('p');
            p.className = 'text-sm fade-in';
            
            switch(type) {
                case 'success': p.classList.add('text-green-400'); break;
                case 'danger': p.classList.add('text-red-400'); break;
                case 'warning': p.classList.add('text-yellow-400'); break;
                case 'info': p.classList.add('text-blue-400'); break;
                default: p.classList.add('text-gray-400');
            }
            
            const time = String(gameState.hour).padStart(2, '0') + ':00';
            p.textContent = `[${time}] ${message}`;
            log.insertBefore(p, log.firstChild);
            
            // Keep only last 20 entries
            while (log.children.length > 20) {
                log.removeChild(log.lastChild);
            }
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const container = document.getElementById('notifications');
            const div = document.createElement('div');
            div.className = `event-notification glass rounded-lg px-4 py-2 text-sm`;
            
            switch(type) {
                case 'success': div.classList.add('border-l-4', 'border-green-500'); break;
                case 'danger': div.classList.add('border-l-4', 'border-red-500'); break;
                case 'warning': div.classList.add('border-l-4', 'border-yellow-500'); break;
                default: div.classList.add('border-l-4', 'border-blue-500');
            }
            
            div.textContent = message;
            container.appendChild(div);
            
            setTimeout(() => div.remove(), 3000);
            
            // Haptic feedback
            if (tg?.HapticFeedback) {
                if (type === 'danger') tg.HapticFeedback.notificationOccurred('error');
                else if (type === 'success') tg.HapticFeedback.notificationOccurred('success');
                else tg.HapticFeedback.impactOccurred('light');
            }
        }

        // Advance time
        function advanceTime(hours) {
            gameState.hour += hours;
            
            while (gameState.hour >= 24) {
                gameState.hour -= 24;
                gameState.day++;
                addLog(`–ù–∞—Å—Ç—É–ø–∏–ª –¥–µ–Ω—å ${gameState.day}`, 'info');
            }
            
            // Decrease stats over time
            gameState.hunger -= hours * 3;
            gameState.thirst -= hours * 4;
            
            // Weather effects
            if (gameState.weather === 'rainy' && !gameState.crafted.shelter) {
                gameState.health -= hours * 2;
                addLog('–í—ã –º–æ–∫–Ω–µ—Ç–µ –ø–æ–¥ –¥–æ–∂–¥—ë–º...', 'warning');
            }
            if (gameState.weather === 'stormy' && !gameState.crafted.shelter) {
                gameState.health -= hours * 5;
                addLog('–ì—Ä–æ–∑–∞ –Ω–∞–Ω–æ—Å–∏—Ç —É—Ä–æ–Ω!', 'danger');
            }
            
            // Low stats damage
            if (gameState.hunger <= 0) {
                gameState.hunger = 0;
                gameState.health -= hours * 5;
                addLog('–í—ã —É–º–∏—Ä–∞–µ—Ç–µ –æ—Ç –≥–æ–ª–æ–¥–∞!', 'danger');
            }
            if (gameState.thirst <= 0) {
                gameState.thirst = 0;
                gameState.health -= hours * 7;
                addLog('–í—ã —É–º–∏—Ä–∞–µ—Ç–µ –æ—Ç –∂–∞–∂–¥—ã!', 'danger');
            }
            
            // Clamp values
            gameState.health = Math.max(0, Math.min(100, gameState.health));
            gameState.hunger = Math.max(0, Math.min(100, gameState.hunger));
            gameState.thirst = Math.max(0, Math.min(100, gameState.thirst));
            gameState.energy = Math.max(0, Math.min(100, gameState.energy));
            
            updateUI();
            checkGameOver();
        }

        // Check game over
        function checkGameOver() {
            if (gameState.health <= 0 && gameState.isAlive) {
                gameState.isAlive = false;
                let reason = '–í—ã –Ω–µ —Å–º–æ–≥–ª–∏ –≤—ã–∂–∏—Ç—å –≤ –¥–∏–∫–æ–π –ø—Ä–∏—Ä–æ–¥–µ.';
                
                if (gameState.hunger <= 0) reason = '–í—ã —É–º–µ—Ä–ª–∏ –æ—Ç –≥–æ–ª–æ–¥–∞.';
                else if (gameState.thirst <= 0) reason = '–í—ã —É–º–µ—Ä–ª–∏ –æ—Ç –æ–±–µ–∑–≤–æ–∂–∏–≤–∞–Ω–∏—è.';
                else if (gameState.weather === 'stormy') reason = '–í–∞—Å —É–±–∏–ª–∞ –≥—Ä–æ–∑–∞.';
                
                document.getElementById('death-reason').textContent = reason;
                document.getElementById('survived-days').textContent = 
                    gameState.day === 1 ? '1 –¥–µ–Ω—å' : `${gameState.day} –¥–Ω–µ–π`;
                document.getElementById('game-over-modal').classList.remove('hidden');
                
                if (tg?.HapticFeedback) {
                    tg.HapticFeedback.notificationOccurred('error');
                }
            }
        }

        // Add item to inventory
        function addItem(itemId, count = 1) {
            for (let i = 0; i < count; i++) {
                if (gameState.inventory.length < 20) {
                    gameState.inventory.push(itemId);
                }
            }
            updateInventory();
        }

        // Remove item from inventory
        function removeItem(itemId, count = 1) {
            for (let i = 0; i < count; i++) {
                const idx = gameState.inventory.indexOf(itemId);
                if (idx > -1) {
                    gameState.inventory.splice(idx, 1);
                }
            }
            updateInventory();
        }

        // Count items
        function countItem(itemId) {
            return gameState.inventory.filter(i => i === itemId).length;
        }

        // Actions
        function doAction(action) {
            if (!gameState.isAlive) return;
            
            switch(action) {
                case 'explore':
                    if (gameState.energy < 10) {
                        showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏!', 'warning');
                        return;
                    }
                    gameState.energy -= 10;
                    
                    const finds = [];
                    const rand = Math.random();
                    
                    if (rand < 0.4) {
                        addItem('wood', Math.floor(Math.random() * 3) + 1);
                        finds.push('–¥—Ä–µ–≤–µ—Å–∏–Ω—É');
                    }
                    if (rand < 0.3) {
                        addItem('stone', Math.floor(Math.random() * 2) + 1);
                        finds.push('–∫–∞–º–Ω–∏');
                    }
                    if (rand < 0.5) {
                        addItem('plant', Math.floor(Math.random() * 2) + 1);
                        finds.push('—Ä–∞—Å—Ç–µ–Ω–∏—è');
                    }
                    if (rand < 0.2) {
                        addItem('berries', Math.floor(Math.random() * 3) + 1);
                        finds.push('—è–≥–æ–¥—ã');
                    }
                    if (rand < 0.1) {
                        addItem('mushroom', 1);
                        finds.push('–≥—Ä–∏–±—ã');
                    }
                    
                    if (finds.length > 0) {
                        addLog(`–í—ã –Ω–∞—à–ª–∏: ${finds.join(', ')}`, 'success');
                        showNotification(`–ù–∞–π–¥–µ–Ω–æ: ${finds.join(', ')}`, 'success');
                    } else {
                        addLog('–í—ã –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞—à–ª–∏...', 'normal');
                        showNotification('–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ', 'warning');
                    }
                    
                    advanceTime(1);
                    break;
                    
                case 'hunt':
                    if (gameState.energy < 20) {
                        showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏!', 'warning');
                        return;
                    }
                    gameState.energy -= 20;
                    
                    let successChance = 0.4;
                    if (gameState.crafted.spear) successChance = 0.7;
                    
                    if (Math.random() < successChance) {
                        const meatCount = gameState.crafted.spear ? 
                            Math.floor(Math.random() * 2) + 2 : 
                            Math.floor(Math.random() * 2) + 1;
                        addItem('meat_raw', meatCount);
                        addLog(`–û—Ö–æ—Ç–∞ —É—Å–ø–µ—à–Ω–∞! –î–æ–±—ã—Ç–æ –º—è—Å–∞: ${meatCount}`, 'success');
                        showNotification(`ü•© –î–æ–±—ã—Ç–æ –º—è—Å–∞: ${meatCount}`, 'success');
                    } else {
                        addLog('–û—Ö–æ—Ç–∞ –Ω–µ—É–¥–∞—á–Ω–∞...', 'warning');
                        showNotification('–î–æ–±—ã—á–∞ —É—Å–∫–æ–ª—å–∑–Ω—É–ª–∞', 'warning');
                    }
                    
                    advanceTime(2);
                    break;
                    
                case 'gather_water':
                    if (gameState.energy < 15) {
                        showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏!', 'warning');
                        return;
                    }
                    gameState.energy -= 15;
                    
                    let waterAmount = gameState.crafted.flask ? 
                        Math.floor(Math.random() * 3) + 3 : 
                        Math.floor(Math.random() * 2) + 1;
                    
                    addItem('water', waterAmount);
                    
                    // Chance to find fish
                    if (Math.random() < 0.3) {
                        addItem('fish', 1);
                        addLog(`–ù–∞–±—Ä–∞–Ω–æ –≤–æ–¥—ã: ${waterAmount}, –ø–æ–π–º–∞–Ω–∞ —Ä—ã–±–∞!`, 'success');
                        showNotification(`üíß –í–æ–¥–∞ +${waterAmount}, üêü –†—ã–±–∞ +1`, 'success');
                    } else {
                        addLog(`–ù–∞–±—Ä–∞–Ω–æ –≤–æ–¥—ã: ${waterAmount}`, 'success');
                        showNotification(`üíß –í–æ–¥–∞ +${waterAmount}`, 'success');
                    }
                    
                    advanceTime(1);
                    break;
                    
                case 'rest':
                    gameState.energy = Math.min(100, gameState.energy + 30);
                    addLog('–í—ã –æ—Ç–¥–æ—Ö–Ω—É–ª–∏ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ —Å–∏–ª—ã.', 'success');
                    showNotification('‚ö° –≠–Ω–µ—Ä–≥–∏—è +30', 'success');
                    advanceTime(2);
                    break;
                    
                case 'eat':
                    // Priority: cooked meat > fish > berries > mushroom > raw meat
                    let foodEaten = null;
                    let hungerRestore = 0;
                    
                    if (countItem('meat_cooked') > 0) {
                        removeItem('meat_cooked');
                        hungerRestore = 35;
                        foodEaten = 'üçñ –∂–∞—Ä–µ–Ω–æ–µ –º—è—Å–æ';
                    } else if (countItem('fish') > 0) {
                        removeItem('fish');
                        hungerRestore = 25;
                        foodEaten = 'üêü —Ä—ã–±—É';
                    } else if (countItem('berries') > 0) {
                        removeItem('berries');
                        hungerRestore = 15;
                        foodEaten = 'ü´ê —è–≥–æ–¥—ã';
                    } else if (countItem('mushroom') > 0) {
                        removeItem('mushroom');
                        hungerRestore = 10;
                        foodEaten = 'üçÑ –≥—Ä–∏–±—ã';
                        // Chance of poisoning
                        if (Math.random() < 0.2) {
                            gameState.health -= 15;
                            addLog('–ì—Ä–∏–±—ã –æ–∫–∞–∑–∞–ª–∏—Å—å —è–¥–æ–≤–∏—Ç—ã–º–∏!', 'danger');
                            showNotification('ü§¢ –û—Ç—Ä–∞–≤–ª–µ–Ω–∏–µ! -15 HP', 'danger');
                        }
                    } else if (countItem('meat_raw') > 0) {
                        removeItem('meat_raw');
                        hungerRestore = 15;
                        foodEaten = 'ü•© —Å—ã—Ä–æ–µ –º—è—Å–æ';
                        // Chance of sickness
                        if (Math.random() < 0.3) {
                            gameState.health -= 10;
                            addLog('–°—ã—Ä–æ–µ –º—è—Å–æ –≤—ã–∑–≤–∞–ª–æ —Ä–∞—Å—Å—Ç—Ä–æ–π—Å—Ç–≤–æ!', 'danger');
                            showNotification('ü§¢ –†–∞—Å—Å—Ç—Ä–æ–π—Å—Ç–≤–æ! -10 HP', 'danger');
                        }
                    }
                    
                    if (foodEaten) {
                        gameState.hunger = Math.min(100, gameState.hunger + hungerRestore);
                        addLog(`–í—ã —Å—ä–µ–ª–∏ ${foodEaten}`, 'success');
                        showNotification(`üçñ –°—ã—Ç–æ—Å—Ç—å +${hungerRestore}`, 'success');
                    } else {
                        showNotification('–ù–µ—Ç –µ–¥—ã –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ!', 'warning');
                    }
                    updateUI();
                    break;
                    
                case 'drink':
                    if (countItem('water') > 0) {
                        removeItem('water');
                        gameState.thirst = Math.min(100, gameState.thirst + 30);
                        addLog('–í—ã —É—Ç–æ–ª–∏–ª–∏ –∂–∞–∂–¥—É.', 'success');
                        showNotification('üíß –ñ–∞–∂–¥–∞ +30', 'success');
                    } else {
                        showNotification('–ù–µ—Ç –≤–æ–¥—ã –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ!', 'warning');
                    }
                    updateUI();
                    break;
                    
                case 'sleep':
                    const hoursUntilMorning = gameState.hour < 6 ? 
                        6 - gameState.hour : 
                        24 - gameState.hour + 6;
                    
                    if (gameState.crafted.shelter) {
                        gameState.energy = 100;
                        addLog('–í—ã —Ö–æ—Ä–æ—à–æ –≤—ã—Å–ø–∞–ª–∏—Å—å –≤ —É–∫—Ä—ã—Ç–∏–∏!', 'success');
                    } else {
                        gameState.energy = Math.min(100, gameState.energy + 60);
                        addLog('–í—ã –ø–æ—Å–ø–∞–ª–∏ –ø–æ–¥ –æ—Ç–∫—Ä—ã—Ç—ã–º –Ω–µ–±–æ–º.', 'info');
                    }
                    
                    showNotification('üò¥ –°–æ–Ω –¥–æ —É—Ç—Ä–∞...', 'info');
                    advanceTime(hoursUntilMorning);
                    break;
            }
        }

        // Crafting
        function craft(item) {
            if (!gameState.isAlive) return;
            
            switch(item) {
                case 'campfire':
                    if (countItem('wood') >= 3 && countItem('stone') >= 2) {
                        removeItem('wood', 3);
                        removeItem('stone', 2);
                        gameState.crafted.campfire = true;
                        addLog('–í—ã —Å–æ–∑–¥–∞–ª–∏ –∫–æ—Å—Ç—ë—Ä! –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –≥–æ—Ç–æ–≤–∏—Ç—å.', 'success');
                        showNotification('üî• –ö–æ—Å—Ç—ë—Ä —Å–æ–∑–¥–∞–Ω!', 'success');
                        
                        // Cook all raw meat
                        const rawMeat = countItem('meat_raw');
                        if (rawMeat > 0) {
                            removeItem('meat_raw', rawMeat);
                            addItem('meat_cooked', rawMeat);
                            addLog(`–ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–æ –º—è—Å–∞: ${rawMeat}`, 'success');
                        }
                    } else {
                        showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–µ—Å—É—Ä—Å–æ–≤!', 'warning');
                    }
                    break;
                    
                case 'shelter':
                    if (countItem('wood') >= 10 && countItem('plant') >= 5) {
                        removeItem('wood', 10);
                        removeItem('plant', 5);
                        gameState.crafted.shelter = true;
                        addLog('–í—ã –ø–æ—Å—Ç—Ä–æ–∏–ª–∏ —É–∫—Ä—ã—Ç–∏–µ! –¢–µ–ø–µ—Ä—å –≤—ã –∑–∞—â–∏—â–µ–Ω—ã –æ—Ç –Ω–µ–ø–æ–≥–æ–¥—ã.', 'success');
                        showNotification('üè† –£–∫—Ä—ã—Ç–∏–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–æ!', 'success');
                    } else {
                        showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–µ—Å—É—Ä—Å–æ–≤!', 'warning');
                    }
                    break;
                    
                case 'spear':
                    if (countItem('wood') >= 2 && countItem('stone') >= 1) {
                        removeItem('wood', 2);
                        removeItem('stone', 1);
                        gameState.crafted.spear = true;
                        addLog('–í—ã —Å–æ–∑–¥–∞–ª–∏ –∫–æ–ø—å—ë! –û—Ö–æ—Ç–∞ —Å—Ç–∞–ª–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ.', 'success');
                        showNotification('üó°Ô∏è –ö–æ–ø—å—ë —Å–æ–∑–¥–∞–Ω–æ!', 'success');
                    } else {
                        showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–µ—Å—É—Ä—Å–æ–≤!', 'warning');
                    }
                    break;
                    
                case 'flask':
                    if (countItem('plant') >= 3 && countItem('water') >= 1) {
                        removeItem('plant', 3);
                        removeItem('water', 1);
                        gameState.crafted.flask = true;
                        addLog('–í—ã —Å–æ–∑–¥–∞–ª–∏ —Ñ–ª—è–≥—É! –ú–æ–∂–Ω–æ –Ω–æ—Å–∏—Ç—å –±–æ–ª—å—à–µ –≤–æ–¥—ã.', 'success');
                        showNotification('üß¥ –§–ª—è–≥–∞ —Å–æ–∑–¥–∞–Ω–∞!', 'success');
                    } else {
                        showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–µ—Å—É—Ä—Å–æ–≤!', 'warning');
                    }
                    break;
            }
            
            updateUI();
        }

        // Restart game
        function restartGame() {
            gameState = {
                day: 1,
                hour: 6,
                health: 100,
                hunger: 100,
                thirst: 100,
                energy: 100,
                inventory: [],
                crafted: {
                    campfire: false,
                    shelter: false,
                    spear: false,
                    flask: false
                },
                weather: 'sunny',
                isAlive: true
            };
            
            document.getElementById('game-over-modal').classList.add('hidden');
            document.getElementById('event-log').innerHTML = '<p class="text-sm text-gray-500 fade-in">–ù–æ–≤–∞—è –∏–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å. –£–¥–∞—á–∏!</p>';
            
            updateUI();
            
            if (tg?.HapticFeedback) {
                tg.HapticFeedback.notificationOccurred('success');
            }
        }

        // Auto-cook meat if campfire exists
        function autoCook() {
            if (gameState.crafted.campfire) {
                const rawMeat = countItem('meat_raw');
                const rawFish = countItem('fish');
                
                if (rawMeat > 0) {
                    removeItem('meat_raw', rawMeat);
                    addItem('meat_cooked', rawMeat);
                }
            }
        }

        // Initialize
        updateUI();
        addLog('–í—ã –æ—á–Ω—É–ª–∏—Å—å –≤ –Ω–µ–∑–Ω–∞–∫–æ–º–æ–º –ª–µ—Å—É. –ù—É–∂–Ω–æ –≤—ã–∂–∏—Ç—å!', 'info');

        // Auto-save and periodic updates
        setInterval(() => {
            if (gameState.isAlive) {
                autoCook();
            }
        }, 5000);
    </script>
</body>
</html>
