<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üíé GemRush - Telegram Game</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Rubik', sans-serif;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            box-sizing: border-box;
        }
        
        body {
            background: #0a0a0f;
            min-height: 100vh;
            min-height: 100dvh;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(120, 0, 255, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(0, 200, 255, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(255, 0, 150, 0.05) 0%, transparent 70%);
            pointer-events: none;
            z-index: 0;
        }

        .game-container {
            position: relative;
            z-index: 1;
        }

        .glass {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .glass-dark {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .neon-border {
            box-shadow: 
                0 0 20px rgba(139, 92, 246, 0.3),
                inset 0 0 20px rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.5);
        }

        .gradient-gold { background: linear-gradient(135deg, #ffd700 0%, #ff8c00 50%, #ff6347 100%); }
        .gradient-blue { background: linear-gradient(135deg, #00d4ff 0%, #5b7cfa 50%, #8b5cf6 100%); }
        .gradient-green { background: linear-gradient(135deg, #00ff87 0%, #00d4aa 50%, #00b894 100%); }
        .gradient-purple { background: linear-gradient(135deg, #a855f7 0%, #8b5cf6 50%, #6366f1 100%); }
        .gradient-pink { background: linear-gradient(135deg, #ff006e 0%, #fb5607 100%); }
        .gradient-red { background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%); }
        .gradient-cyber { background: linear-gradient(135deg, #00f5d4 0%, #00bbf9 50%, #9b5de5 100%); }

        .text-gradient {
            background: linear-gradient(135deg, #fff 0%, #a78bfa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .card-game {
            background: linear-gradient(145deg, rgba(30, 30, 45, 0.8) 0%, rgba(15, 15, 25, 0.9) 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .card-game:hover {
            transform: translateY(-4px) scale(1.01);
            box-shadow: 0 20px 40px rgba(139, 92, 246, 0.2);
            border-color: rgba(139, 92, 246, 0.4);
        }

        .card-game:active { transform: scale(0.98); }

        .btn-game {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .btn-game::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        .btn-game:hover::before { left: 100%; }
        .btn-game:active { transform: scale(0.95); }

        .pulse-glow { animation: pulseGlow 2s ease-in-out infinite; }

        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.4), 0 0 40px rgba(255, 215, 0, 0.2); }
            50% { box-shadow: 0 0 40px rgba(255, 215, 0, 0.6), 0 0 80px rgba(255, 215, 0, 0.4); }
        }

        .float { animation: float 4s ease-in-out infinite; }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-8px) rotate(2deg); }
            75% { transform: translateY(4px) rotate(-2deg); }
        }

        .bounce-in { animation: bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55); }

        @keyframes bounceIn {
            0% { transform: scale(0) rotate(-10deg); opacity: 0; }
            60% { transform: scale(1.1) rotate(3deg); }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        .shake { animation: shake 0.6s cubic-bezier(.36,.07,.19,.97) both; }

        @keyframes shake {
            10%, 90% { transform: translate3d(-2px, 0, 0) rotate(-1deg); }
            20%, 80% { transform: translate3d(4px, 0, 0) rotate(2deg); }
            30%, 50%, 70% { transform: translate3d(-6px, 0, 0) rotate(-3deg); }
            40%, 60% { transform: translate3d(6px, 0, 0) rotate(3deg); }
        }

        .mining-hit { animation: miningHit 0.2s ease-out; }

        @keyframes miningHit {
            0% { transform: scale(1); }
            50% { transform: scale(1.3) rotate(10deg); }
            100% { transform: scale(1); }
        }

        .coin-flip-anim {
            animation: coinFlipAnim 0.8s ease-in-out;
            transform-style: preserve-3d;
        }

        @keyframes coinFlipAnim {
            0% { transform: rotateY(0) scale(1); }
            50% { transform: rotateY(900deg) scale(1.3); }
            100% { transform: rotateY(1800deg) scale(1); }
        }

        .progress-bar { transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1); }

        .energy-bar-fill {
            background: linear-gradient(90deg, #06b6d4 0%, #3b82f6 50%, #8b5cf6 100%);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }

        .xp-bar-fill {
            background: linear-gradient(90deg, #10b981 0%, #34d399 50%, #6ee7b7 100%);
            box-shadow: 0 0 15px rgba(52, 211, 153, 0.5);
        }

        .nav-item {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .nav-item::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            width: 0;
            height: 3px;
            background: linear-gradient(90deg, #8b5cf6, #06b6d4);
            border-radius: 2px;
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }

        .nav-item.active::after { width: 30px; }

        .nav-item.active {
            color: #a78bfa;
            transform: translateY(-3px);
        }

        .nav-item.active .nav-icon {
            transform: scale(1.2);
            filter: drop-shadow(0 0 8px rgba(167, 139, 250, 0.8));
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.4s ease-out;
        }

        .tab-content.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-backdrop {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
        }

        .reward-text { animation: rewardPulse 0.5s ease-out; }

        @keyframes rewardPulse {
            0% { transform: scale(0); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }

        .particle {
            position: absolute;
            pointer-events: none;
            animation: particleFly 1s ease-out forwards;
        }

        @keyframes particleFly {
            0% { opacity: 1; transform: translate(0, 0) scale(1); }
            100% { opacity: 0; transform: translate(var(--tx), var(--ty)) scale(0); }
        }

        .rarity-common { border-color: #6b7280; box-shadow: 0 0 15px rgba(107, 114, 128, 0.3); }
        .rarity-rare { border-color: #3b82f6; box-shadow: 0 0 20px rgba(59, 130, 246, 0.4); }
        .rarity-epic { border-color: #8b5cf6; box-shadow: 0 0 25px rgba(139, 92, 246, 0.5); }
        .rarity-legendary { 
            border-color: #f59e0b; 
            box-shadow: 0 0 30px rgba(245, 158, 11, 0.6);
            animation: legendaryGlow 2s ease-in-out infinite alternate;
        }

        @keyframes legendaryGlow {
            0% { box-shadow: 0 0 20px rgba(245, 158, 11, 0.4); }
            100% { box-shadow: 0 0 40px rgba(245, 158, 11, 0.8); }
        }

        .streak-fire { animation: firePulse 0.5s ease-in-out infinite alternate; }

        @keyframes firePulse {
            0% { transform: scale(1); filter: brightness(1); }
            100% { transform: scale(1.1); filter: brightness(1.3); }
        }

        .slot-machine {
            background: linear-gradient(180deg, #1a1a2e 0%, #0f0f1a 100%);
            border: 3px solid #ffd700;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3), inset 0 0 50px rgba(0, 0, 0, 0.5);
        }

        .daily-bonus-available { animation: dailyPulse 1.5s ease-in-out infinite; }

        @keyframes dailyPulse {
            0%, 100% { box-shadow: 0 0 20px rgba(34, 197, 94, 0.5); }
            50% { box-shadow: 0 0 40px rgba(34, 197, 94, 0.8); }
        }

        .prestige-glow {
            background: linear-gradient(135deg, #ff006e 0%, #8338ec 50%, #3a86ff 100%);
            background-size: 200% 200%;
            animation: prestigeShift 3s ease infinite;
        }

        @keyframes prestigeShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .pet-bounce { animation: petBounce 2s ease-in-out infinite; }

        @keyframes petBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .boss-shake { animation: bossShake 0.3s ease-in-out; }

        @keyframes bossShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px) rotate(-5deg); }
            75% { transform: translateX(10px) rotate(5deg); }
        }

        .roulette-spin { animation: rouletteSpin 3s cubic-bezier(0.17, 0.67, 0.12, 0.99); }

        @keyframes rouletteSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(1800deg); }
        }

        .quest-complete { animation: questComplete 0.5s ease-out; }

        @keyframes questComplete {
            0% { transform: scale(1); background-color: transparent; }
            50% { transform: scale(1.05); background-color: rgba(34, 197, 94, 0.3); }
            100% { transform: scale(1); background-color: transparent; }
        }

        .expedition-progress {
            background: repeating-linear-gradient(
                90deg,
                #4f46e5 0px,
                #4f46e5 10px,
                #6366f1 10px,
                #6366f1 20px
            );
            background-size: 200% 100%;
            animation: expeditionMove 1s linear infinite;
        }

        @keyframes expeditionMove {
            0% { background-position: 0% 0%; }
            100% { background-position: -40px 0%; }
        }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.05); border-radius: 3px; }
        ::-webkit-scrollbar-thumb { background: linear-gradient(180deg, #8b5cf6, #06b6d4); border-radius: 3px; }

        .sub-nav {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding-bottom: 8px;
            scrollbar-width: none;
        }
        .sub-nav::-webkit-scrollbar { display: none; }
        
        .sub-nav-btn {
            flex-shrink: 0;
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .sub-nav-btn.active {
            background: linear-gradient(135deg, #8b5cf6, #6366f1);
            border-color: #8b5cf6;
        }
    </style>
</head>
<body class="text-white pb-24">
    <div class="game-container">
        <!-- Header -->
        <header class="glass-dark sticky top-0 z-50 px-4 py-3 border-b border-white/5">
            <div class="flex items-center justify-between mb-3">
                <div class="flex items-center gap-3">
                    <div class="relative">
                        <div class="w-12 h-12 rounded-2xl gradient-purple flex items-center justify-center font-black text-xl shadow-lg shadow-purple-500/30">
                            <span id="playerInitial">G</span>
                        </div>
                        <div class="absolute -bottom-1 -right-1 bg-gray-900 rounded-full px-1.5 py-0.5 text-xs font-bold border border-purple-500">
                            <span id="playerLevel">1</span>
                        </div>
                    </div>
                    <div>
                        <div class="text-sm font-bold text-gray-300">–£—Ä–æ–≤–µ–Ω—å <span id="headerLevel" class="text-purple-400">1</span></div>
                        <div class="w-28 h-2.5 bg-gray-800 rounded-full overflow-hidden mt-1">
                            <div id="xpBar" class="h-full xp-bar-fill progress-bar rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                <div class="flex gap-2">
                    <div class="glass px-3 py-2 rounded-xl flex items-center gap-2 border border-yellow-500/30">
                        <span class="text-lg">ü™ô</span>
                        <span id="coins" class="font-bold text-yellow-400 text-sm">0</span>
                    </div>
                    <div class="glass px-3 py-2 rounded-xl flex items-center gap-2 border border-purple-500/30">
                        <span class="text-lg">üíé</span>
                        <span id="gems" class="font-bold text-purple-400 text-sm">0</span>
                    </div>
                </div>
            </div>
            <!-- Energy Bar -->
            <div class="bg-gray-800/50 rounded-xl p-2">
                <div class="flex justify-between text-xs mb-1.5 px-1">
                    <span class="text-cyan-400 font-semibold flex items-center gap-1">
                        <span class="text-base">‚ö°</span> –≠–Ω–µ—Ä–≥–∏—è
                    </span>
                    <span class="text-gray-400">
                        <span id="currentEnergy" class="text-cyan-400 font-bold">100</span>/<span id="maxEnergy">100</span>
                    </span>
                </div>
                <div class="w-full h-3 bg-gray-900 rounded-full overflow-hidden border border-gray-700">
                    <div id="energyBar" class="h-full energy-bar-fill progress-bar rounded-full" style="width: 100%"></div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="px-4 py-4">
            <!-- Home Tab -->
            <div id="homeTab" class="tab-content active">
                <div class="text-center mb-5">
                    <h1 class="text-3xl font-black text-gradient mb-1">üíé GemRush</h1>
                    <p class="text-gray-500 text-sm">–î–æ–±—ã–≤–∞–π ‚Ä¢ –ò–≥—Ä–∞–π ‚Ä¢ –ü–æ–±–µ–∂–¥–∞–π!</p>
                </div>

                <!-- Daily Bonus -->
                <div id="dailyBonusCard" class="card-game p-4 mb-4 cursor-pointer daily-bonus-available" onclick="claimDailyBonus()">
                    <div class="flex items-center gap-4">
                        <div class="w-14 h-14 rounded-2xl gradient-green flex items-center justify-center text-3xl float">üéÅ</div>
                        <div class="flex-1">
                            <h3 class="font-bold text-green-400">–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å</h3>
                            <p class="text-gray-400 text-sm">–î–µ–Ω—å <span id="dailyStreak">1</span> üî•</p>
                        </div>
                        <div id="dailyBonusStatus" class="text-green-400 text-sm font-bold">–ó–∞–±—Ä–∞—Ç—å!</div>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="grid grid-cols-3 gap-3 mb-4">
                    <div class="card-game p-3 text-center">
                        <div class="text-2xl mb-1">üèÜ</div>
                        <div class="text-lg font-black text-yellow-400" id="homeCoins">0</div>
                        <div class="text-xs text-gray-500">–ú–æ–Ω–µ—Ç—ã</div>
                    </div>
                    <div class="card-game p-3 text-center">
                        <div class="text-2xl mb-1">‚≠ê</div>
                        <div class="text-lg font-black text-purple-400" id="homeLevel">1</div>
                        <div class="text-xs text-gray-500">–£—Ä–æ–≤–µ–Ω—å</div>
                    </div>
                    <div class="card-game p-3 text-center">
                        <div class="text-2xl mb-1" id="activePetIcon">üê£</div>
                        <div class="text-lg font-black text-cyan-400" id="activePetBonus">+0%</div>
                        <div class="text-xs text-gray-500">–ü–∏—Ç–æ–º–µ—Ü</div>
                    </div>
                </div>

                <!-- Active Quests Preview -->
                <div class="card-game p-4 mb-4">
                    <h3 class="font-bold mb-3 flex items-center gap-2">
                        <span>üìã</span> –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∫–≤–µ—Å—Ç—ã
                        <span id="questsComplete" class="ml-auto text-sm text-gray-400">0/4</span>
                    </h3>
                    <div id="questsPreview" class="space-y-2">
                        <!-- Filled by JS -->
                    </div>
                </div>

                <!-- Achievements -->
                <div class="card-game p-4">
                    <h3 class="font-bold mb-3 flex items-center gap-2">
                        <span>üèÖ</span> –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
                    </h3>
                    <div id="achievementsList" class="grid grid-cols-5 gap-2"></div>
                </div>
            </div>

            <!-- Work Tab -->
            <div id="workTab" class="tab-content">
                <h2 class="text-2xl font-black mb-4 flex items-center gap-2">
                    <span>üíº</span> <span class="text-gradient">–†–∞–±–æ—Ç–∞</span>
                </h2>
                <div class="grid gap-3" id="workList"></div>
            </div>

            <!-- Mine Tab -->
            <div id="mineTab" class="tab-content">
                <h2 class="text-2xl font-black mb-4 flex items-center gap-2">
                    <span>‚õèÔ∏è</span> <span class="text-gradient">–®–∞—Ö—Ç–∞</span>
                </h2>
                
                <!-- Sub Navigation -->
                <div class="sub-nav mb-4">
                    <button class="sub-nav-btn active" onclick="showMineSection('mining')">‚õèÔ∏è –î–æ–±—ã—á–∞</button>
                    <button class="sub-nav-btn" onclick="showMineSection('expeditions')">üó∫Ô∏è –≠–∫—Å–ø–µ–¥–∏—Ü–∏–∏</button>
                    <button class="sub-nav-btn" onclick="showMineSection('craft')">üî® –ö—Ä–∞—Ñ—Ç</button>
                    <button class="sub-nav-btn" onclick="showMineSection('boss')">üëπ –ë–æ—Å—Å</button>
                </div>

                <!-- Mining Section -->
                <div id="miningSection" class="mine-section">
                    <div class="card-game p-6 text-center mb-4">
                        <div id="mineArea" class="relative inline-block">
                            <div id="mineRock" class="text-8xl cursor-pointer select-none transition-transform" onclick="mineRock()">ü™®</div>
                            <div id="mineParticles" class="absolute inset-0 pointer-events-none"></div>
                        </div>
                        <div class="mt-4 space-y-2">
                            <p class="text-gray-400">–¢–∞–ø–∞–π —á—Ç–æ–±—ã –¥–æ–±—ã–≤–∞—Ç—å!</p>
                            <div class="flex justify-center gap-4 text-sm">
                                <span class="text-cyan-400">-3 ‚ö°</span>
                                <span class="text-yellow-400">+5-30 ü™ô</span>
                                <span class="text-purple-400">üíé 3%</span>
                            </div>
                            <div class="text-xs text-gray-500">
                                –ö–∏—Ä–∫–∞: –£—Ä.<span id="pickaxeLevelDisplay">1</span> (x<span id="pickaxeMultiplier">1.0</span>)
                            </div>
                        </div>
                    </div>
                    
                    <div class="card-game p-4 mb-4">
                        <h3 class="font-bold mb-3 flex items-center gap-2">üì¶ –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å —Ä—É–¥—ã</h3>
                        <div class="grid grid-cols-4 gap-2">
                            <div class="bg-gray-800/50 rounded-xl p-3 text-center border border-gray-700">
                                <div class="text-xl mb-1">ite</div>
                                <div class="text-xs text-gray-500">–£–≥–æ–ª—å</div>
                                <div id="coalCount" class="font-bold text-gray-300">0</div>
                            </div>
                            <div class="bg-gray-800/50 rounded-xl p-3 text-center border border-orange-500/30">
                                <div class="text-xl mb-1">üî∂</div>
                                <div class="text-xs text-gray-500">–ñ–µ–ª–µ–∑–æ</div>
                                <div id="ironCount" class="font-bold text-orange-400">0</div>
                            </div>
                            <div class="bg-gray-800/50 rounded-xl p-3 text-center border border-yellow-500/30">
                                <div class="text-xl mb-1">ü•á</div>
                                <div class="text-xs text-gray-500">–ó–æ–ª–æ—Ç–æ</div>
                                <div id="goldCount" class="font-bold text-yellow-400">0</div>
                            </div>
                            <div class="bg-gray-800/50 rounded-xl p-3 text-center border border-purple-500/30">
                                <div class="text-xl mb-1">üíé</div>
                                <div class="text-xs text-gray-500">–ê–ª–º–∞–∑—ã</div>
                                <div id="diamondCount" class="font-bold text-purple-400">0</div>
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="sellOres()" class="w-full btn-game gradient-green text-white font-bold py-4 rounded-2xl shadow-lg shadow-green-500/30">
                        üí∞ –ü—Ä–æ–¥–∞—Ç—å –≤—Å—é —Ä—É–¥—É
                    </button>
                </div>

                <!-- Expeditions Section -->
                <div id="expeditionsSection" class="mine-section hidden">
                    <div class="card-game p-4 mb-4">
                        <h3 class="font-bold mb-3">üó∫Ô∏è –≠–∫—Å–ø–µ–¥–∏—Ü–∏–∏</h3>
                        <p class="text-gray-400 text-sm mb-4">–û—Ç–ø—Ä–∞–≤—å—Ç–µ –ø–∏—Ç–æ–º—Ü–∞ –Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –¥–æ–±—ã—á—É!</p>
                        <div id="expeditionsList" class="space-y-3"></div>
                    </div>
                </div>

                <!-- Craft Section -->
                <div id="craftSection" class="mine-section hidden">
                    <div class="card-game p-4">
                        <h3 class="font-bold mb-3">üî® –ö—Ä–∞—Ñ—Ç–∏–Ω–≥</h3>
                        <p class="text-gray-400 text-sm mb-4">–°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Ü–µ–Ω–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã –∏–∑ —Ä—É–¥—ã!</p>
                        <div id="craftList" class="space-y-3"></div>
                    </div>
                </div>

                <!-- Boss Section -->
                <div id="bossSection" class="mine-section hidden">
                    <div class="card-game p-4 text-center">
                        <h3 class="font-bold mb-4">üëπ –®–∞—Ö—Ç–Ω—ã–π –ë–æ—Å—Å</h3>
                        <div id="bossDisplay" class="text-8xl mb-4">üêâ</div>
                        <div class="mb-4">
                            <div class="flex justify-between text-sm mb-1">
                                <span class="text-red-400">‚ù§Ô∏è HP</span>
                                <span id="bossHpText">1000/1000</span>
                            </div>
                            <div class="w-full h-4 bg-gray-800 rounded-full overflow-hidden">
                                <div id="bossHpBar" class="h-full bg-gradient-to-r from-red-600 to-red-400 transition-all duration-300" style="width: 100%"></div>
                            </div>
                        </div>
                        <button onclick="attackBoss()" class="btn-game gradient-red px-8 py-3 rounded-xl font-bold text-lg">
                            ‚öîÔ∏è –ê—Ç–∞–∫–æ–≤–∞—Ç—å (10 ‚ö°)
                        </button>
                        <p class="text-gray-500 text-sm mt-3">–£—Ä–æ–Ω: <span id="playerDamage">10</span> | –ù–∞–≥—Ä–∞–¥–∞: <span id="bossReward">500</span> ü™ô</p>
                    </div>
                </div>
            </div>

            <!-- Shop Tab -->
            <div id="shopTab" class="tab-content">
                <h2 class="text-2xl font-black mb-4 flex items-center gap-2">
                    <span>üõí</span> <span class="text-gradient">–ú–∞–≥–∞–∑–∏–Ω</span>
                </h2>
                
                <div class="sub-nav mb-4">
                    <button class="sub-nav-btn active" onclick="showShopSection('items')">üéí –ü—Ä–µ–¥–º–µ—Ç—ã</button>
                    <button class="sub-nav-btn" onclick="showShopSection('pets')">üêæ –ü–∏—Ç–æ–º—Ü—ã</button>
                    <button class="sub-nav-btn" onclick="showShopSection('bank')">üè¶ –ë–∞–Ω–∫</button>
                    <button class="sub-nav-btn" onclick="showShopSection('invest')">üìà –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</button>
                </div>

                <div id="itemsSection" class="shop-section">
                    <div id="shopList" class="grid gap-3"></div>
                </div>

                <div id="petsSection" class="shop-section hidden">
                    <div id="petsList" class="grid gap-3"></div>
                </div>

                <div id="bankSection" class="shop-section hidden">
                    <div class="card-game p-4 mb-4">
                        <h3 class="font-bold mb-2">üè¶ –ë–∞–Ω–∫–æ–≤—Å–∫–∏–π –≤–∫–ª–∞–¥</h3>
                        <p class="text-gray-400 text-sm mb-4">–ü–æ–ª–æ–∂–∏—Ç–µ –º–æ–Ω–µ—Ç—ã –ø–æ–¥ 5% –≤ —á–∞—Å!</p>
                        <div class="bg-gray-800/50 rounded-xl p-4 mb-4">
                            <div class="flex justify-between mb-2">
                                <span class="text-gray-400">–ù–∞ —Å—á–µ—Ç—É:</span>
                                <span class="text-yellow-400 font-bold"><span id="bankBalance">0</span> ü™ô</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">–ù–∞–∫–æ–ø–ª–µ–Ω–æ %:</span>
                                <span class="text-green-400 font-bold">+<span id="bankInterest">0</span> ü™ô</span>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="bankDeposit()" class="btn-game gradient-blue py-3 rounded-xl font-bold">
                                üì• –í–ª–æ–∂–∏—Ç—å 1000
                            </button>
                            <button onclick="bankWithdraw()" class="btn-game gradient-green py-3 rounded-xl font-bold">
                                üì§ –ó–∞–±—Ä–∞—Ç—å –≤—Å—ë
                            </button>
                        </div>
                    </div>
                </div>

                <div id="investSection" class="shop-section hidden">
                    <div class="card-game p-4">
                        <h3 class="font-bold mb-2">üìà –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</h3>
                        <p class="text-gray-400 text-sm mb-4">–ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É!</p>
                        <div id="investList" class="space-y-3"></div>
                    </div>
                </div>
            </div>

            <!-- Games Tab -->
            <div id="gamesTab" class="tab-content">
                <h2 class="text-2xl font-black mb-4 flex items-center gap-2">
                    <span>üéÆ</span> <span class="text-gradient">–ú–∏–Ω–∏-–∏–≥—Ä—ã</span>
                </h2>
                <div class="grid gap-4">
                    <!-- Coin Flip -->
                    <div class="card-game p-5">
                        <h3 class="font-bold text-lg mb-3 flex items-center gap-2">ü™ô –ú–æ–Ω–µ—Ç–∫–∞</h3>
                        <div class="text-center mb-4">
                            <div id="coinFlipResult" class="text-6xl mb-3 inline-block">ü™ô</div>
                            <div class="flex justify-center gap-3">
                                <button onclick="playCoinFlip('heads')" class="btn-game gradient-gold px-6 py-2 rounded-xl font-bold">ü¶Ö –û—Ä—ë–ª</button>
                                <button onclick="playCoinFlip('tails')" class="btn-game gradient-purple px-6 py-2 rounded-xl font-bold">üåü –†–µ—à–∫–∞</button>
                            </div>
                        </div>
                        <p class="text-gray-500 text-xs text-center">–°—Ç–∞–≤–∫–∞: 100 ü™ô | –í—ã–∏–≥—Ä—ã—à: x2</p>
                    </div>
                    
                    <!-- Dice -->
                    <div class="card-game p-5">
                        <h3 class="font-bold text-lg mb-3 flex items-center gap-2">üé≤ –ö–æ—Å—Ç–∏</h3>
                        <div class="text-center">
                            <div class="flex justify-center gap-4 mb-3">
                                <div id="dice1" class="text-5xl">üé≤</div>
                                <div id="dice2" class="text-5xl">üé≤</div>
                            </div>
                            <button onclick="playDice()" class="btn-game gradient-blue px-6 py-2 rounded-xl font-bold">üé≤ –ë—Ä–æ—Å–∏—Ç—å (50 ü™ô)</button>
                        </div>
                        <p class="text-gray-500 text-xs text-center mt-2">–î—É–±–ª—å = x3 | –°—É–º–º–∞ 7 = x2 | 12 = x5</p>
                    </div>

                    <!-- Roulette -->
                    <div class="card-game p-5">
                        <h3 class="font-bold text-lg mb-3 flex items-center gap-2">üé° –†—É–ª–µ—Ç–∫–∞</h3>
                        <div class="text-center">
                            <div id="rouletteWheel" class="text-6xl mb-3 inline-block">üé°</div>
                            <div class="grid grid-cols-3 gap-2 mb-3">
                                <button onclick="playRoulette('red')" class="bg-red-600 hover:bg-red-500 py-2 rounded-xl font-bold transition-all">üî¥ x2</button>
                                <button onclick="playRoulette('green')" class="bg-green-600 hover:bg-green-500 py-2 rounded-xl font-bold transition-all">üü¢ x14</button>
                                <button onclick="playRoulette('black')" class="bg-gray-800 hover:bg-gray-700 py-2 rounded-xl font-bold transition-all border border-gray-600">‚ö´ x2</button>
                            </div>
                        </div>
                        <p class="text-gray-500 text-xs text-center">–°—Ç–∞–≤–∫–∞: 100 ü™ô</p>
                    </div>

                    <!-- Number Guess -->
                    <div class="card-game p-5">
                        <h3 class="font-bold text-lg mb-3 flex items-center gap-2">üî¢ –£–≥–∞–¥–∞–π —á–∏—Å–ª–æ</h3>
                        <div class="text-center">
                            <div id="guessDisplay" class="text-5xl font-black mb-3 text-cyan-400">?</div>
                            <div class="grid grid-cols-5 gap-2 mb-3">
                                ${[1,2,3,4,5,6,7,8,9,10].map(n => `<button onclick="guessNumber(${n})" class="bg-gray-800 hover:bg-purple-600 py-2 rounded-xl font-bold transition-all">${n}</button>`).join('')}
                            </div>
                        </div>
                        <p class="text-gray-500 text-xs text-center">–°—Ç–∞–≤–∫–∞: 100 ü™ô | –£–≥–∞–¥–∞–ª = x10</p>
                    </div>
                </div>
            </div>

            <!-- Casino Tab -->
            <div id="casinoTab" class="tab-content">
                <h2 class="text-2xl font-black mb-4 flex items-center gap-2">
                    <span>üé∞</span> <span class="text-gradient">–ö–∞–∑–∏–Ω–æ</span>
                </h2>
                
                <!-- Slots -->
                <div class="card-game p-5 mb-4 slot-machine">
                    <h3 class="font-bold text-lg mb-4 text-center text-yellow-400">üé∞ –°–ª–æ—Ç-–º–∞—à–∏–Ω–∞</h3>
                    <div class="flex justify-center gap-2 mb-4">
                        <div class="w-16 h-20 bg-gray-900 rounded-xl flex items-center justify-center text-4xl border-2 border-yellow-500/50">
                            <span id="slot1">üçí</span>
                        </div>
                        <div class="w-16 h-20 bg-gray-900 rounded-xl flex items-center justify-center text-4xl border-2 border-yellow-500/50">
                            <span id="slot2">üçã</span>
                        </div>
                        <div class="w-16 h-20 bg-gray-900 rounded-xl flex items-center justify-center text-4xl border-2 border-yellow-500/50">
                            <span id="slot3">üçä</span>
                        </div>
                    </div>
                    <div class="flex justify-center gap-2 flex-wrap">
                        <button onclick="playSlots(50)" class="btn-game bg-yellow-600 hover:bg-yellow-500 px-4 py-2 rounded-xl font-bold text-sm">50 ü™ô</button>
                        <button onclick="playSlots(100)" class="btn-game bg-purple-600 hover:bg-purple-500 px-4 py-2 rounded-xl font-bold text-sm">100 ü™ô</button>
                        <button onclick="playSlots(500)" class="btn-game bg-pink-600 hover:bg-pink-500 px-4 py-2 rounded-xl font-bold text-sm">500 ü™ô</button>
                    </div>
                    <p class="text-center text-xs text-gray-400 mt-3">üçíüçíüçí=x3 | üíéüíéüíé=x20 | 7Ô∏è‚É£7Ô∏è‚É£7Ô∏è‚É£=x50</p>
                </div>

                <!-- Cases -->
                <div class="card-game p-4">
                    <h3 class="font-bold text-lg mb-3">üì¶ –ö–µ–π—Å—ã</h3>
                    <div id="casesList" class="grid gap-3"></div>
                </div>
            </div>

            <!-- Profile Tab -->
            <div id="profileTab" class="tab-content">
                <h2 class="text-2xl font-black mb-4 flex items-center gap-2">
                    <span>üë§</span> <span class="text-gradient">–ü—Ä–æ—Ñ–∏–ª—å</span>
                </h2>
                
                <div class="card-game p-5 text-center mb-4">
                    <div class="w-20 h-20 mx-auto rounded-3xl gradient-purple flex items-center justify-center text-4xl mb-3 shadow-lg shadow-purple-500/30">
                        <span id="profileAvatar">üéÆ</span>
                    </div>
                    <h3 class="text-xl font-black mb-1" id="playerName">–ò–≥—Ä–æ–∫</h3>
                    <p class="text-purple-400 mb-3">–£—Ä–æ–≤–µ–Ω—å <span id="profileLevel">1</span></p>
                    <div class="bg-gray-800/50 rounded-xl p-3">
                        <div class="flex justify-between text-sm mb-2">
                            <span class="text-gray-400">–û–ø—ã—Ç</span>
                            <span class="text-green-400"><span id="currentXp">0</span>/<span id="neededXp">100</span></span>
                        </div>
                        <div class="w-full h-3 bg-gray-900 rounded-full overflow-hidden">
                            <div id="profileXpBar" class="h-full xp-bar-fill progress-bar rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <!-- Prestige -->
                <div class="card-game p-4 mb-4 neon-border">
                    <div class="flex items-center gap-4">
                        <div class="w-14 h-14 rounded-xl prestige-glow flex items-center justify-center text-3xl">‚≠ê</div>
                        <div class="flex-1">
                            <h3 class="font-bold text-purple-300">–ü—Ä–µ—Å—Ç–∏–∂</h3>
                            <p class="text-gray-400 text-sm">–£—Ä–æ–≤–µ–Ω—å <span id="prestigeLevel">0</span></p>
                            <p class="text-xs text-gray-500">–ë–æ–Ω—É—Å: +<span id="prestigeBonus">0</span>% –∫–æ –≤—Å–µ–º—É</p>
                        </div>
                        <button onclick="doPrestige()" class="btn-game prestige-glow px-4 py-2 rounded-xl font-bold text-sm">
                            üîÑ –ü—Ä–µ—Å—Ç–∏–∂
                        </button>
                    </div>
                </div>
                
                <div class="card-game p-4 mb-4">
                    <h3 class="font-bold mb-3 flex items-center gap-2">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="bg-gray-800/50 rounded-xl p-3 text-center">
                            <div class="text-xl mb-1">ü™ô</div>
                            <div class="text-xs text-gray-500">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</div>
                            <div id="totalEarned" class="font-bold text-yellow-400">0</div>
                        </div>
                        <div class="bg-gray-800/50 rounded-xl p-3 text-center">
                            <div class="text-xl mb-1">üéÆ</div>
                            <div class="text-xs text-gray-500">–ò–≥—Ä</div>
                            <div id="gamesPlayed" class="font-bold text-blue-400">0</div>
                        </div>
                        <div class="bg-gray-800/50 rounded-xl p-3 text-center">
                            <div class="text-xl mb-1">‚õèÔ∏è</div>
                            <div class="text-xs text-gray-500">–î–æ–±—ã—Ç–æ</div>
                            <div id="totalMined" class="font-bold text-orange-400">0</div>
                        </div>
                        <div class="bg-gray-800/50 rounded-xl p-3 text-center">
                            <div class="text-xl mb-1">üëπ</div>
                            <div class="text-xs text-gray-500">–ë–æ—Å—Å–æ–≤</div>
                            <div id="bossesKilled" class="font-bold text-red-400">0</div>
                        </div>
                        <div class="bg-gray-800/50 rounded-xl p-3 text-center">
                            <div class="text-xl mb-1">üî•</div>
                            <div class="text-xs text-gray-500">–°–µ—Ä–∏—è –¥–Ω–µ–π</div>
                            <div id="profileStreak" class="font-bold text-orange-400">0</div>
                        </div>
                        <div class="bg-gray-800/50 rounded-xl p-3 text-center">
                            <div class="text-xl mb-1">‚è±Ô∏è</div>
                            <div class="text-xs text-gray-500">–í—Ä–µ–º—è</div>
                            <div id="playTime" class="font-bold text-cyan-400">0–º</div>
                        </div>
                    </div>
                </div>

                <button onclick="resetProgress()" class="w-full bg-red-900/30 border border-red-500/30 text-red-400 font-bold py-3 rounded-xl hover:bg-red-900/50 transition-all">
                    üîÑ –°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
                </button>
            </div>
        </main>

        <!-- Navigation -->
        <nav class="fixed bottom-0 left-0 right-0 glass-dark border-t border-white/5 px-2 py-2 z-50">
            <div class="flex justify-around max-w-lg mx-auto">
                <button onclick="showTab('home')" class="nav-item active flex flex-col items-center px-2 py-1" data-tab="home">
                    <span class="nav-icon text-xl">üè†</span>
                    <span class="text-[10px] mt-0.5">–î–æ–º</span>
                </button>
                <button onclick="showTab('work')" class="nav-item flex flex-col items-center px-2 py-1" data-tab="work">
                    <span class="nav-icon text-xl">üíº</span>
                    <span class="text-[10px] mt-0.5">–†–∞–±–æ—Ç–∞</span>
                </button>
                <button onclick="showTab('mine')" class="nav-item flex flex-col items-center px-2 py-1" data-tab="mine">
                    <span class="nav-icon text-xl">‚õèÔ∏è</span>
                    <span class="text-[10px] mt-0.5">–®–∞—Ö—Ç–∞</span>
                </button>
                <button onclick="showTab('shop')" class="nav-item flex flex-col items-center px-2 py-1" data-tab="shop">
                    <span class="nav-icon text-xl">üõí</span>
                    <span class="text-[10px] mt-0.5">–ú–∞–≥–∞–∑–∏–Ω</span>
                </button>
                <button onclick="showTab('games')" class="nav-item flex flex-col items-center px-2 py-1" data-tab="games">
                    <span class="nav-icon text-xl">üéÆ</span>
                    <span class="text-[10px] mt-0.5">–ò–≥—Ä—ã</span>
                </button>
                <button onclick="showTab('casino')" class="nav-item flex flex-col items-center px-2 py-1" data-tab="casino">
                    <span class="nav-icon text-xl">üé∞</span>
                    <span class="text-[10px] mt-0.5">–ö–∞–∑–∏–Ω–æ</span>
                </button>
                <button onclick="showTab('profile')" class="nav-item flex flex-col items-center px-2 py-1" data-tab="profile">
                    <span class="nav-icon text-xl">üë§</span>
                    <span class="text-[10px] mt-0.5">–ü—Ä–æ—Ñ–∏–ª—å</span>
                </button>
            </div>
        </nav>

        <!-- Modal -->
        <div id="modal" class="fixed inset-0 modal-backdrop z-50 hidden items-center justify-center p-4" style="display: none;">
            <div class="card-game p-6 max-w-sm w-full bounce-in">
                <div id="modalContent" class="text-center"></div>
                <button onclick="closeModal()" class="w-full mt-4 bg-gray-700 hover:bg-gray-600 py-3 rounded-xl font-bold transition-all">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>

        <!-- Toast -->
        <div id="toast" class="fixed top-20 left-1/2 -translate-x-1/2 glass-dark px-5 py-2.5 rounded-2xl z-50 transition-all duration-300 opacity-0 pointer-events-none border border-white/10 text-sm">
            <span id="toastText"></span>
        </div>
    </div>

    <script>
        // ============ GAME DATA ============
        const WORKS = [
            { id: 'delivery', name: '–ö—É—Ä—å–µ—Ä', icon: 'üö¥', min: 30, max: 80, energy: 5, xp: 10, color: 'from-green-500 to-emerald-600' },
            { id: 'office', name: '–û—Ñ–∏—Å', icon: 'üè¢', min: 80, max: 150, energy: 10, xp: 20, color: 'from-blue-500 to-indigo-600' },
            { id: 'business', name: '–ë–∏–∑–Ω–µ—Å', icon: 'üíº', min: 200, max: 500, energy: 20, xp: 40, color: 'from-purple-500 to-pink-600' },
            { id: 'crypto', name: '–ö—Ä–∏–ø—Ç–æ—Ç—Ä–µ–π–¥–∏–Ω–≥', icon: '‚Çø', min: -500, max: 2000, energy: 40, xp: 100, risk: 0.3, color: 'from-yellow-500 to-orange-600' },
            { id: 'hacking', name: '–•–∞–∫–∏–Ω–≥', icon: 'üíª', min: 500, max: 3000, energy: 60, xp: 150, levelReq: 10, color: 'from-cyan-500 to-blue-600' }
        ];

        const PETS = [
            { id: 'cat', name: '–ö–æ—Ç–∏–∫', icon: 'üê±', bonus: 5, type: 'coins', price: 500, currency: 'coins' },
            { id: 'dog', name: '–ü—ë—Å–∏–∫', icon: 'üêï', bonus: 10, type: 'xp', price: 800, currency: 'coins' },
            { id: 'dragon', name: '–î—Ä–∞–∫–æ–Ω', icon: 'üêâ', bonus: 15, type: 'coins', price: 10, currency: 'gems' },
            { id: 'unicorn', name: '–ï–¥–∏–Ω–æ—Ä–æ–≥', icon: 'ü¶Ñ', bonus: 20, type: 'luck', price: 25, currency: 'gems' },
            { id: 'phoenix', name: '–§–µ–Ω–∏–∫—Å', icon: 'üî•', bonus: 25, type: 'energy', price: 50, currency: 'gems' },
            { id: 'robot', name: '–†–æ–±–æ—Ç', icon: 'ü§ñ', bonus: 30, type: 'all', price: 100, currency: 'gems' }
        ];

        const SHOP_ITEMS = [
            { id: 'energy50', name: '–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫', desc: '+50 —ç–Ω–µ—Ä–≥–∏–∏', icon: '‚ö°', price: 150, currency: 'coins' },
            { id: 'energyFull', name: '–ú–µ–≥–∞-—ç–Ω–µ—Ä–≥–∏—è', desc: '–ü–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ', icon: 'üîã', price: 3, currency: 'gems' },
            { id: 'pickaxe', name: '–£–ª—É—á—à–∏—Ç—å –∫–∏—Ä–∫—É', desc: '+25% –∫ –¥–æ–±—ã—á–µ', icon: '‚õèÔ∏è', dynamic: true },
            { id: 'battery', name: '–ë–∞—Ç–∞—Ä–µ—è', desc: '+25 –º–∞–∫—Å. —ç–Ω–µ—Ä–≥–∏–∏', icon: 'üîã', dynamic: true },
            { id: 'gems10', name: '10 –ì–µ–º–æ–≤', desc: '–ü—Ä–µ–º–∏—É–º –≤–∞–ª—é—Ç–∞', icon: 'üíé', price: 2500, currency: 'coins' },
            { id: 'luck', name: '–¢–∞–ª–∏—Å–º–∞–Ω —É–¥–∞—á–∏', desc: '+10% —Ä–µ–¥–∫–æ–π —Ä—É–¥—ã', icon: 'üçÄ', price: 10, currency: 'gems' },
            { id: 'sword', name: '–ú–µ—á +10 —É—Ä–æ–Ω–∞', desc: '–î–ª—è –±–æ—Å—Å–æ–≤', icon: '‚öîÔ∏è', price: 1000, currency: 'coins' },
            { id: 'shield', name: '–©–∏—Ç +20 —É—Ä–æ–Ω–∞', desc: '–î–ª—è –±–æ—Å—Å–æ–≤', icon: 'üõ°Ô∏è', price: 20, currency: 'gems' }
        ];

        const INVESTMENTS = [
            { id: 'farm', name: '–§–µ—Ä–º–∞', icon: 'üåæ', income: 10, price: 500, currency: 'coins' },
            { id: 'mine', name: '–®–∞—Ö—Ç–∞', icon: '‚õèÔ∏è', income: 25, price: 1500, currency: 'coins' },
            { id: 'factory', name: '–ó–∞–≤–æ–¥', icon: 'üè≠', income: 60, price: 5000, currency: 'coins' },
            { id: 'casino', name: '–ö–∞–∑–∏–Ω–æ', icon: 'üé∞', income: 150, price: 15000, currency: 'coins' },
            { id: 'rocket', name: '–†–∞–∫–µ—Ç–∞', icon: 'üöÄ', income: 500, price: 100, currency: 'gems' }
        ];

        const EXPEDITIONS = [
            { id: 'forest', name: '–õ–µ—Å', icon: 'üå≤', duration: 60, rewards: { coins: 100, coal: 5 } },
            { id: 'cave', name: '–ü–µ—â–µ—Ä–∞', icon: 'üï≥Ô∏è', duration: 300, rewards: { coins: 300, iron: 3, gold: 1 } },
            { id: 'volcano', name: '–í—É–ª–∫–∞–Ω', icon: 'üåã', duration: 900, rewards: { coins: 800, gold: 3, diamond: 1 } },
            { id: 'space', name: '–ö–æ—Å–º–æ—Å', icon: 'üöÄ', duration: 1800, rewards: { coins: 2000, diamond: 3, gems: 1 } }
        ];

        const CRAFTS = [
            { id: 'ring', name: '–ó–æ–ª–æ—Ç–æ–µ –∫–æ–ª—å—Ü–æ', icon: 'üíç', requires: { gold: 5 }, gives: { coins: 500 } },
            { id: 'necklace', name: '–ê–ª–º–∞–∑–Ω–æ–µ –æ–∂–µ—Ä–µ–ª—å–µ', icon: 'üìø', requires: { diamond: 3, gold: 2 }, gives: { coins: 1500, gems: 1 } },
            { id: 'crown', name: '–ö–æ—Ä–æ–Ω–∞', icon: 'üëë', requires: { diamond: 10, gold: 20 }, gives: { coins: 10000, gems: 5 } },
            { id: 'sword', name: '–ê–ª–º–∞–∑–Ω—ã–π –º–µ—á', icon: 'üó°Ô∏è', requires: { diamond: 5, iron: 10 }, gives: { damage: 20 } }
        ];

        const CASES = [
            { id: 'common', name: '–û–±—ã—á–Ω—ã–π', icon: 'üì¶', price: 100, currency: 'coins', min: 50, max: 200, gemChance: 0.05 },
            { id: 'rare', name: '–†–µ–¥–∫–∏–π', icon: 'üéÅ', price: 400, currency: 'coins', min: 200, max: 800, gemChance: 0.15, rarity: 'rare' },
            { id: 'epic', name: '–≠–ø–∏—á–µ—Å–∫–∏–π', icon: 'üíú', price: 5, currency: 'gems', min: 500, max: 2000, gemChance: 0.3, rarity: 'epic' },
            { id: 'legendary', name: '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π', icon: 'üëë', price: 25, currency: 'gems', min: 2000, max: 15000, gemChance: 0.5, rarity: 'legendary' }
        ];

        const ACHIEVEMENTS = [
            { id: 'first_coin', name: '–ü–µ—Ä–≤—ã–µ –º–æ–Ω–µ—Ç—ã', icon: 'ü™ô', condition: s => s.stats.totalEarned >= 100 },
            { id: 'rich', name: '–ë–æ–≥–∞—á', icon: 'üí∞', condition: s => s.coins >= 10000 },
            { id: 'miner', name: '–®–∞—Ö—Ç—ë—Ä', icon: '‚õèÔ∏è', condition: s => s.stats.totalMined >= 100 },
            { id: 'gamer', name: '–ò–≥—Ä–æ–∫', icon: 'üéÆ', condition: s => s.stats.gamesPlayed >= 50 },
            { id: 'lucky', name: '–í–µ–∑—É–Ω—á–∏–∫', icon: 'üçÄ', condition: s => s.stats.casinoWins >= 25 },
            { id: 'veteran', name: '–í–µ—Ç–µ—Ä–∞–Ω', icon: 'üèÖ', condition: s => s.level >= 10 },
            { id: 'dedicated', name: '–ü—Ä–µ–¥–∞–Ω–Ω—ã–π', icon: 'üî•', condition: s => s.stats.dailyStreak >= 7 },
            { id: 'collector', name: '–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä', icon: 'üíé', condition: s => s.gems >= 50 },
            { id: 'boss_slayer', name: '–£–±–∏–π—Ü–∞ –±–æ—Å—Å–æ–≤', icon: 'üëπ', condition: s => s.stats.bossesKilled >= 10 },
            { id: 'investor', name: '–ò–Ω–≤–µ—Å—Ç–æ—Ä', icon: 'üìà', condition: s => Object.keys(s.investments || {}).length >= 3 }
        ];

        const BOSSES = [
            { id: 'slime', name: '–°–ª–∏–∑–µ–Ω—å', icon: 'üü¢', hp: 500, reward: 300 },
            { id: 'goblin', name: '–ì–æ–±–ª–∏–Ω', icon: 'üë∫', hp: 1000, reward: 700 },
            { id: 'dragon', name: '–î—Ä–∞–∫–æ–Ω', icon: 'üêâ', hp: 2500, reward: 2000 },
            { id: 'demon', name: '–î–µ–º–æ–Ω', icon: 'üëø', hp: 5000, reward: 5000 },
            { id: 'titan', name: '–¢–∏—Ç–∞–Ω', icon: 'üóø', hp: 10000, reward: 15000 }
        ];

        // ============ GAME STATE ============
        const DEFAULT_STATE = {
            coins: 500,
            gems: 5,
            energy: 100,
            maxEnergy: 100,
            level: 1,
            xp: 0,
            xpNeeded: 100,
            pickaxeLevel: 1,
            batteryLevel: 1,
            damage: 10,
            hasLuckCharm: false,
            ores: { coal: 0, iron: 0, gold: 0, diamond: 0 },
            pets: [],
            activePet: null,
            investments: {},
            bank: { balance: 0, lastUpdate: Date.now() },
            expeditions: {},
            prestige: 0,
            currentBoss: 0,
            bossHp: 500,
            stats: {
                totalEarned: 0,
                gamesPlayed: 0,
                totalMined: 0,
                casinoWins: 0,
                dailyStreak: 0,
                playTimeMinutes: 0,
                bossesKilled: 0
            },
            quests: {
                lastReset: null,
                progress: { mine: 0, work: 0, games: 0, spend: 0 },
                claimed: []
            },
            lastDaily: null,
            lastEnergyRegen: Date.now(),
            achievements: [],
            createdAt: Date.now()
        };

        let gameState = JSON.parse(JSON.stringify(DEFAULT_STATE));
        let isAnimating = false;

        // ============ STORAGE ============
        const STORAGE_KEY = 'gemrush_save_v3';

        function saveGame() {
            try {
                gameState.lastSave = Date.now();
                localStorage.setItem(STORAGE_KEY, JSON.stringify(gameState));
            } catch (e) { console.error('Save failed:', e); }
        }

        function loadGame() {
            try {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) {
                    const parsed = JSON.parse(saved);
                    gameState = { ...JSON.parse(JSON.stringify(DEFAULT_STATE)), ...parsed };
                    gameState.ores = { ...DEFAULT_STATE.ores, ...parsed.ores };
                    gameState.stats = { ...DEFAULT_STATE.stats, ...parsed.stats };
                    gameState.quests = { ...DEFAULT_STATE.quests, ...parsed.quests };
                    gameState.bank = { ...DEFAULT_STATE.bank, ...parsed.bank };
                    gameState.investments = parsed.investments || {};
                    gameState.expeditions = parsed.expeditions || {};
                    gameState.pets = parsed.pets || [];
                    calculateOfflineProgress();
                }
            } catch (e) {
                console.error('Load failed:', e);
                gameState = JSON.parse(JSON.stringify(DEFAULT_STATE));
            }
            initializeGame();
        }

        function calculateOfflineProgress() {
            const now = Date.now();
            
            // Energy regen
            const lastRegen = gameState.lastEnergyRegen || now;
            const offlineSeconds = Math.floor((now - lastRegen) / 1000);
            const energyGained = Math.floor(offlineSeconds / 6);
            if (energyGained > 0) {
                const oldEnergy = gameState.energy;
                gameState.energy = Math.min(gameState.energy + energyGained, gameState.maxEnergy);
                if (gameState.energy - oldEnergy > 0) {
                    setTimeout(() => showToast(`‚ö° +${gameState.energy - oldEnergy} —ç–Ω–µ—Ä–≥–∏–∏ –∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ!`, 'success'), 500);
                }
            }
            gameState.lastEnergyRegen = now;

            // Bank interest
            const bankTime = Math.floor((now - gameState.bank.lastUpdate) / 1000 / 60); // minutes
            if (bankTime > 0 && gameState.bank.balance > 0) {
                const interest = Math.floor(gameState.bank.balance * 0.05 * (bankTime / 60));
                if (interest > 0) {
                    gameState.bank.balance += interest;
                    setTimeout(() => showToast(`üè¶ +${interest} ü™ô –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤!`, 'success'), 1000);
                }
            }
            gameState.bank.lastUpdate = now;

            // Investment income
            const investTime = Math.floor(offlineSeconds / 60);
            if (investTime > 0) {
                let totalIncome = 0;
                for (const [id, count] of Object.entries(gameState.investments)) {
                    const inv = INVESTMENTS.find(i => i.id === id);
                    if (inv) totalIncome += inv.income * count * investTime;
                }
                if (totalIncome > 0) {
                    gameState.coins += totalIncome;
                    setTimeout(() => showToast(`üìà +${formatNumber(totalIncome)} ü™ô –æ—Ç –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π!`, 'success'), 1500);
                }
            }

            // Check expeditions
            for (const [id, exp] of Object.entries(gameState.expeditions)) {
                if (exp.endTime && now >= exp.endTime) {
                    const expedition = EXPEDITIONS.find(e => e.id === id);
                    if (expedition) {
                        for (const [key, val] of Object.entries(expedition.rewards)) {
                            if (key === 'coins') gameState.coins += val;
                            else if (key === 'gems') gameState.gems += val;
                            else if (gameState.ores[key] !== undefined) gameState.ores[key] += val;
                        }
                        setTimeout(() => showToast(`üó∫Ô∏è –≠–∫—Å–ø–µ–¥–∏—Ü–∏—è "${expedition.name}" –∑–∞–≤–µ—Ä—à–µ–Ω–∞!`, 'success'), 2000);
                    }
                    delete gameState.expeditions[id];
                }
            }
        }

        function resetProgress() {
            if (confirm('–í–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å –±—É–¥–µ—Ç –ø–æ—Ç–µ—Ä—è–Ω! –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
                localStorage.removeItem(STORAGE_KEY);
                gameState = JSON.parse(JSON.stringify(DEFAULT_STATE));
                initializeGame();
                showToast('–ü—Ä–æ–≥—Ä–µ—Å—Å —Å–±—Ä–æ—à–µ–Ω', 'info');
            }
        }

        // ============ UI ============
        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return Math.floor(num).toString();
        }

        function formatTime(seconds) {
            if (seconds < 60) return seconds + '—Å';
            if (seconds < 3600) return Math.floor(seconds / 60) + '–º';
            return Math.floor(seconds / 3600) + '—á ' + Math.floor((seconds % 3600) / 60) + '–º';
        }

        function updateAllUI() {
            // Header
            document.getElementById('coins').textContent = formatNumber(gameState.coins);
            document.getElementById('gems').textContent = gameState.gems;
            document.getElementById('currentEnergy').textContent = Math.floor(gameState.energy);
            document.getElementById('maxEnergy').textContent = gameState.maxEnergy;
            document.getElementById('energyBar').style.width = (gameState.energy / gameState.maxEnergy * 100) + '%';
            document.getElementById('playerLevel').textContent = gameState.level;
            document.getElementById('headerLevel').textContent = gameState.level;
            document.getElementById('xpBar').style.width = (gameState.xp / gameState.xpNeeded * 100) + '%';

            // Home
            document.getElementById('homeCoins').textContent = formatNumber(gameState.coins);
            document.getElementById('homeLevel').textContent = gameState.level;
            document.getElementById('dailyStreak').textContent = gameState.stats.dailyStreak;

            // Active pet
            const pet = PETS.find(p => p.id === gameState.activePet);
            document.getElementById('activePetIcon').textContent = pet ? pet.icon : 'üê£';
            document.getElementById('activePetBonus').textContent = pet ? `+${pet.bonus}%` : '+0%';

            // Mine
            document.getElementById('coalCount').textContent = gameState.ores.coal;
            document.getElementById('ironCount').textContent = gameState.ores.iron;
            document.getElementById('goldCount').textContent = gameState.ores.gold;
            document.getElementById('diamondCount').textContent = gameState.ores.diamond;
            document.getElementById('pickaxeLevelDisplay').textContent = gameState.pickaxeLevel;
            document.getElementById('pickaxeMultiplier').textContent = (1 + (gameState.pickaxeLevel - 1) * 0.25).toFixed(2);

            // Boss
            const boss = BOSSES[gameState.currentBoss];
            document.getElementById('bossDisplay').textContent = boss.icon;
            document.getElementById('bossHpText').textContent = `${gameState.bossHp}/${boss.hp}`;
            document.getElementById('bossHpBar').style.width = (gameState.bossHp / boss.hp * 100) + '%';
            document.getElementById('playerDamage').textContent = gameState.damage;
            document.getElementById('bossReward').textContent = boss.reward;

            // Bank
            document.getElementById('bankBalance').textContent = formatNumber(gameState.bank.balance);

            // Profile
            document.getElementById('profileLevel').textContent = gameState.level;
            document.getElementById('currentXp').textContent = gameState.xp;
            document.getElementById('neededXp').textContent = gameState.xpNeeded;
            document.getElementById('profileXpBar').style.width = (gameState.xp / gameState.xpNeeded * 100) + '%';
            document.getElementById('totalEarned').textContent = formatNumber(gameState.stats.totalEarned);
            document.getElementById('gamesPlayed').textContent = gameState.stats.gamesPlayed;
            document.getElementById('totalMined').textContent = gameState.stats.totalMined;
            document.getElementById('bossesKilled').textContent = gameState.stats.bossesKilled;
            document.getElementById('profileStreak').textContent = gameState.stats.dailyStreak;
            document.getElementById('playTime').textContent = gameState.stats.playTimeMinutes + '–º';
            document.getElementById('prestigeLevel').textContent = gameState.prestige;
            document.getElementById('prestigeBonus').textContent = gameState.prestige * 10;

            updateQuests();
            updateAchievements();
            checkDailyBonus();
            saveGame();
        }

        function showTab(tab) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(tab + 'Tab').classList.add('active');
            document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
            hapticFeedback('light');
        }

        function showMineSection(section) {
            document.querySelectorAll('.mine-section').forEach(s => s.classList.add('hidden'));
            document.querySelectorAll('#mineTab .sub-nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(section + 'Section').classList.remove('hidden');
            event.target.classList.add('active');
        }

        function showShopSection(section) {
            document.querySelectorAll('.shop-section').forEach(s => s.classList.add('hidden'));
            document.querySelectorAll('#shopTab .sub-nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(section + 'Section').classList.remove('hidden');
            event.target.classList.add('active');
        }

        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            const toastText = document.getElementById('toastText');
            toastText.textContent = message;
            toast.className = 'fixed top-20 left-1/2 -translate-x-1/2 glass-dark px-5 py-2.5 rounded-2xl z-50 transition-all duration-300 border text-sm';
            toast.classList.add(type === 'success' ? 'border-green-500/50' : type === 'error' ? 'border-red-500/50' : 'border-white/10');
            toast.style.opacity = '1';
            setTimeout(() => toast.style.opacity = '0', 2500);
        }

        function showModal(title, message, emoji = 'üéâ') {
            const modal = document.getElementById('modal');
            document.getElementById('modalContent').innerHTML = `
                <div class="text-6xl mb-4 reward-text">${emoji}</div>
                <h3 class="text-xl font-black mb-2">${title}</h3>
                <p class="text-gray-400">${message}</p>
            `;
            modal.style.display = 'flex';
            hapticFeedback('success');
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        function hapticFeedback(type = 'light') {
            if (window.Telegram?.WebApp?.HapticFeedback) {
                if (type === 'success') window.Telegram.WebApp.HapticFeedback.notificationOccurred('success');
                else if (type === 'error') window.Telegram.WebApp.HapticFeedback.notificationOccurred('error');
                else window.Telegram.WebApp.HapticFeedback.impactOccurred(type);
            }
        }

        // ============ GAME LOGIC ============
        function getBonus(type) {
            let bonus = 1 + gameState.prestige * 0.1;
            const pet = PETS.find(p => p.id === gameState.activePet);
            if (pet && (pet.type === type || pet.type === 'all')) {
                bonus += pet.bonus / 100;
            }
            return bonus;
        }

        function addXP(amount) {
            gameState.xp += Math.floor(amount * getBonus('xp'));
            while (gameState.xp >= gameState.xpNeeded) {
                gameState.xp -= gameState.xpNeeded;
                gameState.level++;
                gameState.xpNeeded = Math.floor(100 * Math.pow(1.4, gameState.level - 1));
                const coinBonus = gameState.level * 100;
                const gemBonus = gameState.level >= 5 ? Math.floor(gameState.level / 5) : 0;
                gameState.coins += coinBonus;
                gameState.gems += gemBonus;
                showModal('üéâ –£—Ä–æ–≤–µ–Ω—å ' + gameState.level + '!', `+${coinBonus} ü™ô` + (gemBonus ? ` +${gemBonus} üíé` : ''), '‚¨ÜÔ∏è');
            }
            updateAllUI();
        }

        function addQuestProgress(type, amount = 1) {
            if (!gameState.quests.progress) gameState.quests.progress = { mine: 0, work: 0, games: 0, spend: 0 };
            gameState.quests.progress[type] = (gameState.quests.progress[type] || 0) + amount;
            updateQuests();
        }

        // Daily Bonus
        function checkDailyBonus() {
            const today = new Date().toDateString();
            const card = document.getElementById('dailyBonusCard');
            const status = document.getElementById('dailyBonusStatus');
            if (gameState.lastDaily === today) {
                card.classList.remove('daily-bonus-available');
                card.style.opacity = '0.5';
                status.textContent = '–ü–æ–ª—É—á–µ–Ω–æ ‚úì';
            } else {
                card.classList.add('daily-bonus-available');
                card.style.opacity = '1';
                status.textContent = '–ó–∞–±—Ä–∞—Ç—å!';
            }
        }

        function claimDailyBonus() {
            const today = new Date().toDateString();
            if (gameState.lastDaily === today) {
                showToast('–ë–æ–Ω—É—Å —É–∂–µ –ø–æ–ª—É—á–µ–Ω!', 'error');
                return;
            }
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            if (gameState.lastDaily === yesterday.toDateString()) {
                gameState.stats.dailyStreak++;
            } else {
                gameState.stats.dailyStreak = 1;
            }
            gameState.lastDaily = today;
            
            // Reset quests
            gameState.quests = { lastReset: today, progress: { mine: 0, work: 0, games: 0, spend: 0 }, claimed: [] };
            
            const streak = gameState.stats.dailyStreak;
            const coins = 100 * streak;
            const gems = streak >= 7 ? Math.floor(streak / 7) * 2 : 0;
            gameState.coins += coins;
            gameState.gems += gems;
            gameState.energy = gameState.maxEnergy;
            
            showModal(`üî• –î–µ–Ω—å ${streak}!`, `+${coins} ü™ô +100% ‚ö°` + (gems ? ` +${gems} üíé` : ''), 'üéÅ');
            updateAllUI();
        }

        // Quests
        const QUESTS = [
            { id: 'mine', name: '–î–æ–±—ã—Ç—å —Ä—É–¥—É', target: 20, reward: 200, icon: '‚õèÔ∏è' },
            { id: 'work', name: '–ü–æ—Ä–∞–±–æ—Ç–∞—Ç—å', target: 5, reward: 150, icon: 'üíº' },
            { id: 'games', name: '–°—ã–≥—Ä–∞—Ç—å –≤ –∏–≥—Ä—ã', target: 10, reward: 300, icon: 'üéÆ' },
            { id: 'spend', name: '–ü–æ—Ç—Ä–∞—Ç–∏—Ç—å –º–æ–Ω–µ—Ç—ã', target: 1000, reward: 500, icon: 'üí∏' }
        ];

        function updateQuests() {
            const container = document.getElementById('questsPreview');
            const today = new Date().toDateString();
            if (gameState.quests.lastReset !== today) {
                gameState.quests = { lastReset: today, progress: { mine: 0, work: 0, games: 0, spend: 0 }, claimed: [] };
            }
            
            let completed = 0;
            container.innerHTML = QUESTS.map(q => {
                const progress = Math.min(gameState.quests.progress[q.id] || 0, q.target);
                const done = progress >= q.target;
                const claimed = gameState.quests.claimed.includes(q.id);
                if (done) completed++;
                
                return `
                    <div class="flex items-center gap-3 bg-gray-800/30 rounded-xl p-2 ${done && !claimed ? 'quest-complete' : ''}" onclick="${done && !claimed ? `claimQuest('${q.id}')` : ''}">
                        <div class="text-xl">${q.icon}</div>
                        <div class="flex-1">
                            <div class="text-sm font-medium ${claimed ? 'text-gray-500 line-through' : ''}">${q.name}</div>
                            <div class="w-full h-1.5 bg-gray-700 rounded-full mt-1">
                                <div class="h-full ${done ? 'bg-green-500' : 'bg-purple-500'} rounded-full transition-all" style="width: ${progress / q.target * 100}%"></div>
                            </div>
                        </div>
                        <div class="text-xs ${claimed ? 'text-gray-500' : done ? 'text-green-400' : 'text-gray-400'}">
                            ${claimed ? '‚úì' : `${progress}/${q.target}`}
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('questsComplete').textContent = `${completed}/4`;
        }

        function claimQuest(id) {
            const quest = QUESTS.find(q => q.id === id);
            if (!quest || gameState.quests.claimed.includes(id)) return;
            gameState.quests.claimed.push(id);
            gameState.coins += quest.reward;
            gameState.stats.totalEarned += quest.reward;
            showToast(`+${quest.reward} ü™ô –∑–∞ –∫–≤–µ—Å—Ç!`, 'success');
            addXP(50);
            updateAllUI();
        }

        // Work
        function renderWork() {
            document.getElementById('workList').innerHTML = WORKS.map(w => {
                const locked = w.levelReq && gameState.level < w.levelReq;
                return `
                    <div class="card-game p-4 ${locked ? 'opacity-50' : 'cursor-pointer'}" onclick="${locked ? '' : `doWork('${w.id}')`}">
                        <div class="flex items-center gap-4">
                            <div class="w-14 h-14 rounded-2xl bg-gradient-to-br ${w.color} flex items-center justify-center text-2xl float shadow-lg">${w.icon}</div>
                            <div class="flex-1">
                                <h3 class="font-bold">${w.name} ${locked ? `üîí –£—Ä.${w.levelReq}` : ''}</h3>
                                <p class="text-gray-400 text-sm">+${w.min}-${w.max} ü™ô | -${w.energy} ‚ö°</p>
                                <p class="text-green-400 text-xs">+${w.xp} XP ${w.risk ? '| –†–∏—Å–∫!' : ''}</p>
                            </div>
                            <div class="text-xl text-gray-600">‚ñ∂</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function doWork(id) {
            const work = WORKS.find(w => w.id === id);
            if (!work || (work.levelReq && gameState.level < work.levelReq)) return;
            if (gameState.energy < work.energy) {
                showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏!', 'error');
                return;
            }
            
            gameState.energy -= work.energy;
            let reward;
            
            if (work.risk && Math.random() < work.risk) {
                reward = -Math.floor(Math.random() * 300);
                gameState.coins = Math.max(0, gameState.coins + reward);
                showToast(`üìâ –ü–æ—Ç–µ—Ä—è–Ω–æ ${Math.abs(reward)} ü™ô`, 'error');
            } else {
                reward = Math.floor((Math.random() * (work.max - work.min) + work.min) * getBonus('coins'));
                gameState.coins += reward;
                gameState.stats.totalEarned += reward;
                showToast(`+${reward} ü™ô | +${work.xp} XP`, 'success');
            }
            
            addQuestProgress('work');
            addXP(work.xp);
            hapticFeedback('medium');
        }

        // Mining
        function mineRock() {
            if (isAnimating || gameState.energy < 3) {
                if (gameState.energy < 3) showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏!', 'error');
                return;
            }
            
            isAnimating = true;
            gameState.energy -= 3;
            gameState.stats.totalMined++;
            addQuestProgress('mine');
            
            const rock = document.getElementById('mineRock');
            rock.classList.add('mining-hit');
            createParticles();
            setTimeout(() => { rock.classList.remove('mining-hit'); isAnimating = false; }, 200);
            
            const bonus = (1 + (gameState.pickaxeLevel - 1) * 0.25) * getBonus('coins');
            const luck = gameState.hasLuckCharm ? 0.1 : 0;
            const roll = Math.random();
            
            if (roll < 0.03 + luck) {
                gameState.ores.diamond++;
                if (Math.random() < 0.2) gameState.gems++;
                showToast('üíé –ê–ª–º–∞–∑!', 'success');
            } else if (roll < 0.10 + luck) {
                gameState.ores.gold += Math.ceil(2 * bonus);
                showToast('+–∑–æ–ª–æ—Ç–æ!', 'success');
            } else if (roll < 0.30 + luck) {
                gameState.ores.iron += Math.ceil(3 * bonus);
            } else {
                gameState.ores.coal += Math.ceil(5 * bonus);
            }
            
            const coins = Math.floor((Math.random() * 25 + 5) * bonus);
            gameState.coins += coins;
            gameState.stats.totalEarned += coins;
            addXP(3);
            hapticFeedback('light');
        }

        function createParticles() {
            const container = document.getElementById('mineParticles');
            for (let i = 0; i < 5; i++) {
                const p = document.createElement('div');
                p.className = 'particle';
                p.textContent = ['‚ú®', 'üí´', '‚≠ê', 'ü™ô'][Math.floor(Math.random() * 4)];
                p.style.cssText = `left:50%;top:50%;--tx:${Math.random()*100-50}px;--ty:${Math.random()*-80-20}px;font-size:20px;`;
                container.appendChild(p);
                setTimeout(() => p.remove(), 1000);
            }
        }

        function sellOres() {
            const prices = { coal: 3, iron: 12, gold: 50, diamond: 150 };
            let total = Object.entries(gameState.ores).reduce((sum, [k, v]) => sum + v * prices[k], 0);
            if (total === 0) { showToast('–ù–µ—Ç —Ä—É–¥—ã!', 'error'); return; }
            
            gameState.coins += total;
            gameState.stats.totalEarned += total;
            gameState.ores = { coal: 0, iron: 0, gold: 0, diamond: 0 };
            showToast(`+${total} ü™ô`, 'success');
            addXP(Math.floor(total / 10));
        }

        // Boss
        function attackBoss() {
            if (gameState.energy < 10) { showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏!', 'error'); return; }
            
            gameState.energy -= 10;
            const damage = Math.floor(gameState.damage * getBonus('coins'));
            gameState.bossHp -= damage;
            
            const bossEl = document.getElementById('bossDisplay');
            bossEl.classList.add('boss-shake');
            setTimeout(() => bossEl.classList.remove('boss-shake'), 300);
            
            if (gameState.bossHp <= 0) {
                const boss = BOSSES[gameState.currentBoss];
                gameState.coins += boss.reward;
                gameState.stats.totalEarned += boss.reward;
                gameState.stats.bossesKilled++;
                
                if (gameState.currentBoss < BOSSES.length - 1) {
                    gameState.currentBoss++;
                }
                gameState.bossHp = BOSSES[gameState.currentBoss].hp;
                
                showModal('üëπ –ë–æ—Å—Å –ø–æ–≤–µ—Ä–∂–µ–Ω!', `+${boss.reward} ü™ô`, '‚öîÔ∏è');
                addXP(200);
            } else {
                showToast(`-${damage} —É—Ä–æ–Ω–∞!`, 'success');
            }
            
            hapticFeedback('heavy');
            updateAllUI();
        }

        // Shop
        function renderShop() {
            document.getElementById('shopList').innerHTML = SHOP_ITEMS.map(item => {
                let price = item.price;
                let priceText = '';
                
                if (item.id === 'pickaxe') {
                    price = 300 * gameState.pickaxeLevel;
                    priceText = `${price} ü™ô`;
                } else if (item.id === 'battery') {
                    price = 500 * gameState.batteryLevel;
                    priceText = `${price} ü™ô`;
                } else {
                    priceText = `${price} ${item.currency === 'gems' ? 'üíé' : 'ü™ô'}`;
                }
                
                return `
                    <div class="card-game p-4">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-xl bg-gray-800 flex items-center justify-center text-2xl">${item.icon}</div>
                            <div class="flex-1">
                                <h3 class="font-bold text-sm">${item.name}</h3>
                                <p class="text-gray-400 text-xs">${item.desc}</p>
                            </div>
                            <button onclick="buyItem('${item.id}')" class="btn-game gradient-blue px-3 py-2 rounded-xl font-bold text-sm">${priceText}</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderPets() {
            document.getElementById('petsList').innerHTML = PETS.map(pet => {
                const owned = gameState.pets.includes(pet.id);
                const active = gameState.activePet === pet.id;
                return `
                    <div class="card-game p-4 ${active ? 'neon-border' : ''}">
                        <div class="flex items-center gap-4">
                            <div class="w-14 h-14 rounded-xl bg-gray-800 flex items-center justify-center text-3xl ${owned ? 'pet-bounce' : 'grayscale opacity-50'}">${pet.icon}</div>
                            <div class="flex-1">
                                <h3 class="font-bold">${pet.name} ${active ? '‚úì' : ''}</h3>
                                <p class="text-gray-400 text-sm">+${pet.bonus}% ${pet.type === 'coins' ? '–º–æ–Ω–µ—Ç' : pet.type === 'xp' ? '–æ–ø—ã—Ç–∞' : pet.type === 'luck' ? '—É–¥–∞—á–∏' : pet.type === 'energy' ? '—ç–Ω–µ—Ä–≥–∏–∏' : '–∫–æ –≤—Å–µ–º—É'}</p>
                            </div>
                            ${owned ? 
                                `<button onclick="activatePet('${pet.id}')" class="btn-game ${active ? 'bg-gray-600' : 'gradient-green'} px-3 py-2 rounded-xl font-bold text-sm">${active ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–í—ã–±—Ä–∞—Ç—å'}</button>` :
                                `<button onclick="buyPet('${pet.id}')" class="btn-game gradient-purple px-3 py-2 rounded-xl font-bold text-sm">${pet.price} ${pet.currency === 'gems' ? 'üíé' : 'ü™ô'}</button>`
                            }
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderInvestments() {
            document.getElementById('investList').innerHTML = INVESTMENTS.map(inv => {
                const count = gameState.investments[inv.id] || 0;
                return `
                    <div class="bg-gray-800/50 rounded-xl p-3 flex items-center gap-3">
                        <div class="text-3xl">${inv.icon}</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-sm">${inv.name}</h4>
                            <p class="text-xs text-gray-400">+${inv.income}/–º–∏–Ω | –ö—É–ø–ª–µ–Ω–æ: ${count}</p>
                        </div>
                        <button onclick="buyInvestment('${inv.id}')" class="btn-game gradient-gold px-3 py-2 rounded-xl font-bold text-xs">
                            ${inv.price} ${inv.currency === 'gems' ? 'üíé' : 'ü™ô'}
                        </button>
                    </div>
                `;
            }).join('');
        }

        function renderExpeditions() {
            const now = Date.now();
            document.getElementById('expeditionsList').innerHTML = EXPEDITIONS.map(exp => {
                const active = gameState.expeditions[exp.id];
                const timeLeft = active ? Math.max(0, Math.floor((active.endTime - now) / 1000)) : 0;
                
                return `
                    <div class="bg-gray-800/50 rounded-xl p-4">
                        <div class="flex items-center gap-3 mb-2">
                            <div class="text-3xl">${exp.icon}</div>
                            <div class="flex-1">
                                <h4 class="font-bold">${exp.name}</h4>
                                <p class="text-xs text-gray-400">${formatTime(exp.duration)}</p>
                            </div>
                            ${active ? 
                                `<span class="text-cyan-400 text-sm">${formatTime(timeLeft)}</span>` :
                                `<button onclick="startExpedition('${exp.id}')" class="btn-game gradient-blue px-4 py-2 rounded-xl font-bold text-sm">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>`
                            }
                        </div>
                        ${active ? `<div class="h-2 bg-gray-700 rounded-full overflow-hidden"><div class="h-full expedition-progress" style="width: ${(1 - timeLeft / exp.duration) * 100}%"></div></div>` : ''}
                        <p class="text-xs text-gray-500 mt-2">–ù–∞–≥—Ä–∞–¥–∞: ${Object.entries(exp.rewards).map(([k,v]) => `${v} ${k === 'coins' ? 'ü™ô' : k === 'gems' ? 'üíé' : k}`).join(', ')}</p>
                    </div>
                `;
            }).join('');
        }

        function renderCrafts() {
            document.getElementById('craftList').innerHTML = CRAFTS.map(craft => {
                const canCraft = Object.entries(craft.requires).every(([k, v]) => gameState.ores[k] >= v);
                return `
                    <div class="bg-gray-800/50 rounded-xl p-4 ${canCraft ? '' : 'opacity-50'}">
                        <div class="flex items-center gap-3">
                            <div class="text-3xl">${craft.icon}</div>
                            <div class="flex-1">
                                <h4 class="font-bold">${craft.name}</h4>
                                <p class="text-xs text-gray-400">–ù—É–∂–Ω–æ: ${Object.entries(craft.requires).map(([k,v]) => `${v} ${k}`).join(', ')}</p>
                                <p class="text-xs text-green-400">–î–∞—ë—Ç: ${Object.entries(craft.gives).map(([k,v]) => `+${v} ${k === 'coins' ? 'ü™ô' : k === 'gems' ? 'üíé' : k === 'damage' ? '‚öîÔ∏è' : k}`).join(', ')}</p>
                            </div>
                            <button onclick="doCraft('${craft.id}')" class="btn-game gradient-purple px-4 py-2 rounded-xl font-bold text-sm" ${canCraft ? '' : 'disabled'}>–°–æ–∑–¥–∞—Ç—å</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderCases() {
            document.getElementById('casesList').innerHTML = CASES.map(c => `
                <div class="bg-gray-800/50 rounded-xl p-4 cursor-pointer ${c.rarity ? 'rarity-' + c.rarity : ''}" onclick="openCase('${c.id}')">
                    <div class="flex items-center gap-4">
                        <div class="text-4xl ${c.rarity === 'legendary' ? 'streak-fire' : ''}">${c.icon}</div>
                        <div class="flex-1">
                            <h4 class="font-bold">${c.name}</h4>
                            <p class="text-sm text-gray-400">${c.min}-${c.max} ü™ô</p>
                        </div>
                        <div class="font-bold">${c.price} ${c.currency === 'gems' ? 'üíé' : 'ü™ô'}</div>
                    </div>
                </div>
            `).join('');
        }

        function buyItem(id) {
            const item = SHOP_ITEMS.find(i => i.id === id);
            let price = item.price;
            let currency = item.currency || 'coins';
            
            if (id === 'pickaxe') { price = 300 * gameState.pickaxeLevel; currency = 'coins'; }
            if (id === 'battery') { price = 500 * gameState.batteryLevel; currency = 'coins'; }
            
            if ((currency === 'coins' && gameState.coins < price) || (currency === 'gems' && gameState.gems < price)) {
                showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!', 'error'); return;
            }
            
            if (currency === 'coins') { gameState.coins -= price; addQuestProgress('spend', price); }
            else gameState.gems -= price;
            
            switch(id) {
                case 'energy50': gameState.energy = Math.min(gameState.energy + 50, gameState.maxEnergy); break;
                case 'energyFull': gameState.energy = gameState.maxEnergy; break;
                case 'pickaxe': gameState.pickaxeLevel++; break;
                case 'battery': gameState.maxEnergy += 25; gameState.batteryLevel++; break;
                case 'gems10': gameState.gems += 10; break;
                case 'luck': gameState.hasLuckCharm = true; break;
                case 'sword': gameState.damage += 10; break;
                case 'shield': gameState.damage += 20; break;
            }
            
            showToast('–ö—É–ø–ª–µ–Ω–æ!', 'success');
            hapticFeedback('medium');
            updateAllUI();
            renderShop();
        }

        function buyPet(id) {
            const pet = PETS.find(p => p.id === id);
            if ((pet.currency === 'coins' && gameState.coins < pet.price) || (pet.currency === 'gems' && gameState.gems < pet.price)) {
                showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!', 'error'); return;
            }
            
            if (pet.currency === 'coins') gameState.coins -= pet.price;
            else gameState.gems -= pet.price;
            
            gameState.pets.push(pet.id);
            gameState.activePet = pet.id;
            
            showModal('üêæ –ü–∏—Ç–æ–º–µ—Ü –ø–æ–ª—É—á–µ–Ω!', `${pet.icon} ${pet.name} —Ç–µ–ø–µ—Ä—å —Å –≤–∞–º–∏!`, pet.icon);
            renderPets();
            updateAllUI();
        }

        function activatePet(id) {
            gameState.activePet = id;
            showToast('–ü–∏—Ç–æ–º–µ—Ü –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!', 'success');
            renderPets();
            updateAllUI();
        }

        function buyInvestment(id) {
            const inv = INVESTMENTS.find(i => i.id === id);
            if ((inv.currency === 'coins' && gameState.coins < inv.price) || (inv.currency === 'gems' && gameState.gems < inv.price)) {
                showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!', 'error'); return;
            }
            
            if (inv.currency === 'coins') { gameState.coins -= inv.price; addQuestProgress('spend', inv.price); }
            else gameState.gems -= inv.price;
            
            gameState.investments[id] = (gameState.investments[id] || 0) + 1;
            showToast(`${inv.icon} +${inv.income}/–º–∏–Ω!`, 'success');
            renderInvestments();
            updateAllUI();
        }

        function startExpedition(id) {
            if (gameState.expeditions[id]) { showToast('–£–∂–µ –≤ –ø—É—Ç–∏!', 'error'); return; }
            const exp = EXPEDITIONS.find(e => e.id === id);
            gameState.expeditions[id] = { endTime: Date.now() + exp.duration * 1000 };
            showToast(`${exp.icon} –≠–∫—Å–ø–µ–¥–∏—Ü–∏—è –Ω–∞—á–∞–ª–∞—Å—å!`, 'success');
            renderExpeditions();
            updateAllUI();
        }

        function doCraft(id) {
            const craft = CRAFTS.find(c => c.id === id);
            if (!Object.entries(craft.requires).every(([k, v]) => gameState.ores[k] >= v)) {
                showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–µ—Å—É—Ä—Å–æ–≤!', 'error'); return;
            }
            
            for (const [k, v] of Object.entries(craft.requires)) {
                gameState.ores[k] -= v;
            }
            
            for (const [k, v] of Object.entries(craft.gives)) {
                if (k === 'coins') { gameState.coins += v; gameState.stats.totalEarned += v; }
                else if (k === 'gems') gameState.gems += v;
                else if (k === 'damage') gameState.damage += v;
            }
            
            showModal('üî® –°–æ–∑–¥–∞–Ω–æ!', `${craft.icon} ${craft.name}`, craft.icon);
            addXP(100);
            renderCrafts();
        }

        function bankDeposit() {
            if (gameState.coins < 1000) { showToast('–ù—É–∂–Ω–æ 1000 ü™ô!', 'error'); return; }
            gameState.coins -= 1000;
            gameState.bank.balance += 1000;
            addQuestProgress('spend', 1000);
            showToast('–í–ª–æ–∂–µ–Ω–æ 1000 ü™ô', 'success');
            updateAllUI();
        }

        function bankWithdraw() {
            if (gameState.bank.balance <= 0) { showToast('–°—á—ë—Ç –ø—É—Å—Ç!', 'error'); return; }
            gameState.coins += gameState.bank.balance;
            showToast(`+${gameState.bank.balance} ü™ô`, 'success');
            gameState.bank.balance = 0;
            updateAllUI();
        }

        // Games
        function playCoinFlip(choice) {
            if (isAnimating || gameState.coins < 100) { showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!', 'error'); return; }
            isAnimating = true;
            gameState.coins -= 100;
            gameState.stats.gamesPlayed++;
            addQuestProgress('games');
            addQuestProgress('spend', 100);
            
            const coin = document.getElementById('coinFlipResult');
            coin.classList.add('coin-flip-anim');
            
            setTimeout(() => {
                coin.classList.remove('coin-flip-anim');
                const result = Math.random() < 0.5 ? 'heads' : 'tails';
                coin.textContent = result === 'heads' ? 'ü¶Ö' : 'üåü';
                
                if (result === choice) {
                    const win = Math.floor(200 * getBonus('coins'));
                    gameState.coins += win;
                    gameState.stats.totalEarned += win;
                    gameState.stats.casinoWins++;
                    showToast(`+${win} ü™ô!`, 'success');
                } else {
                    showToast('–ù–µ –ø–æ–≤–µ–∑–ª–æ!', 'error');
                }
                
                addXP(10);
                isAnimating = false;
                setTimeout(() => coin.textContent = 'ü™ô', 1500);
            }, 800);
            
            hapticFeedback('medium');
            updateAllUI();
        }

        const diceEmojis = ['‚öÄ', '‚öÅ', '‚öÇ', '‚öÉ', '‚öÑ', '‚öÖ'];
        
        function playDice() {
            if (isAnimating || gameState.coins < 50) { showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!', 'error'); return; }
            isAnimating = true;
            gameState.coins -= 50;
            gameState.stats.gamesPlayed++;
            addQuestProgress('games');
            addQuestProgress('spend', 50);
            
            let rolls = 0;
            const interval = setInterval(() => {
                document.getElementById('dice1').textContent = diceEmojis[Math.floor(Math.random() * 6)];
                document.getElementById('dice2').textContent = diceEmojis[Math.floor(Math.random() * 6)];
                if (++rolls > 12) {
                    clearInterval(interval);
                    const r1 = Math.floor(Math.random() * 6) + 1;
                    const r2 = Math.floor(Math.random() * 6) + 1;
                    document.getElementById('dice1').textContent = diceEmojis[r1 - 1];
                    document.getElementById('dice2').textContent = diceEmojis[r2 - 1];
                    
                    let win = 0;
                    if (r1 === r2) win = 150;
                    else if (r1 + r2 === 7) win = 100;
                    else if (r1 + r2 === 12) win = 250;
                    
                    if (win) {
                        win = Math.floor(win * getBonus('coins'));
                        gameState.coins += win;
                        gameState.stats.totalEarned += win;
                        gameState.stats.casinoWins++;
                        showToast(`+${win} ü™ô!`, 'success');
                    } else {
                        showToast('–ù–µ –ø–æ–≤–µ–∑–ª–æ!', 'error');
                    }
                    
                    addXP(10);
                    isAnimating = false;
                }
            }, 80);
            
            hapticFeedback('medium');
            updateAllUI();
        }

        function playRoulette(bet) {
            if (isAnimating || gameState.coins < 100) { showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!', 'error'); return; }
            isAnimating = true;
            gameState.coins -= 100;
            gameState.stats.gamesPlayed++;
            addQuestProgress('games');
            addQuestProgress('spend', 100);
            
            const wheel = document.getElementById('rouletteWheel');
            wheel.classList.add('roulette-spin');
            
            setTimeout(() => {
                wheel.classList.remove('roulette-spin');
                const results = ['red', 'black', 'red', 'black', 'red', 'black', 'red', 'black', 'green'];
                const result = results[Math.floor(Math.random() * results.length)];
                wheel.textContent = result === 'red' ? 'üî¥' : result === 'black' ? '‚ö´' : 'üü¢';
                
                let win = 0;
                if (result === bet) {
                    win = result === 'green' ? 1400 : 200;
                    win = Math.floor(win * getBonus('coins'));
                    gameState.coins += win;
                    gameState.stats.totalEarned += win;
                    gameState.stats.casinoWins++;
                    showToast(`+${win} ü™ô!`, 'success');
                } else {
                    showToast('–ù–µ –ø–æ–≤–µ–∑–ª–æ!', 'error');
                }
                
                addXP(15);
                isAnimating = false;
                setTimeout(() => wheel.textContent = 'üé°', 1500);
            }, 3000);
            
            hapticFeedback('medium');
            updateAllUI();
        }

        function guessNumber(num) {
            if (isAnimating || gameState.coins < 100) { showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!', 'error'); return; }
            isAnimating = true;
            gameState.coins -= 100;
            gameState.stats.gamesPlayed++;
            addQuestProgress('games');
            addQuestProgress('spend', 100);
            
            const display = document.getElementById('guessDisplay');
            let rolls = 0;
            const interval = setInterval(() => {
                display.textContent = Math.floor(Math.random() * 10) + 1;
                if (++rolls > 15) {
                    clearInterval(interval);
                    const result = Math.floor(Math.random() * 10) + 1;
                    display.textContent = result;
                    
                    if (result === num) {
                        const win = Math.floor(1000 * getBonus('coins'));
                        gameState.coins += win;
                        gameState.stats.totalEarned += win;
                        gameState.stats.casinoWins++;
                        showModal('üéâ –î–ñ–ï–ö–ü–û–¢!', `+${win} ü™ô`, 'üî¢');
                    } else {
                        showToast(`–ë—ã–ª–æ: ${result}`, 'error');
                    }
                    
                    addXP(10);
                    isAnimating = false;
                    setTimeout(() => display.textContent = '?', 2000);
                }
            }, 80);
            
            hapticFeedback('medium');
            updateAllUI();
        }

        // Slots
        const slotSymbols = ['üçí', 'üçã', 'üçä', 'üçá', '‚≠ê', 'üíé', '7Ô∏è‚É£'];
        
        function playSlots(bet) {
            if (isAnimating || gameState.coins < bet) { showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!', 'error'); return; }
            isAnimating = true;
            gameState.coins -= bet;
            gameState.stats.gamesPlayed++;
            addQuestProgress('games');
            addQuestProgress('spend', bet);
            
            let rolls = 0;
            const interval = setInterval(() => {
                document.getElementById('slot1').textContent = slotSymbols[Math.floor(Math.random() * 7)];
                document.getElementById('slot2').textContent = slotSymbols[Math.floor(Math.random() * 7)];
                document.getElementById('slot3').textContent = slotSymbols[Math.floor(Math.random() * 7)];
                
                if (++rolls > 20) {
                    clearInterval(interval);
                    const r1 = slotSymbols[Math.floor(Math.random() * 7)];
                    const r2 = slotSymbols[Math.floor(Math.random() * 7)];
                    const r3 = slotSymbols[Math.floor(Math.random() * 7)];
                    document.getElementById('slot1').textContent = r1;
                    document.getElementById('slot2').textContent = r2;
                    document.getElementById('slot3').textContent = r3;
                    
                    let mult = 0;
                    if (r1 === r2 && r2 === r3) {
                        mult = r1 === '7Ô∏è‚É£' ? 50 : r1 === 'üíé' ? 20 : r1 === '‚≠ê' ? 10 : 5;
                    } else if (r1 === r2 || r2 === r3 || r1 === r3) {
                        mult = 1.5;
                    }
                    
                    if (mult) {
                        const win = Math.floor(bet * mult * getBonus('coins'));
                        gameState.coins += win;
                        gameState.stats.totalEarned += win;
                        gameState.stats.casinoWins++;
                        if (mult >= 10) showModal('üé∞ –î–ñ–ï–ö–ü–û–¢!', `+${win} ü™ô (x${mult})`, 'üéâ');
                        else showToast(`+${win} ü™ô!`, 'success');
                    } else {
                        showToast('–ù–µ –ø–æ–≤–µ–∑–ª–æ!', 'error');
                    }
                    
                    addXP(15);
                    isAnimating = false;
                }
            }, 80);
            
            hapticFeedback('medium');
            updateAllUI();
        }

        function openCase(id) {
            const c = CASES.find(x => x.id === id);
            if ((c.currency === 'coins' && gameState.coins < c.price) || (c.currency === 'gems' && gameState.gems < c.price)) {
                showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!', 'error'); return;
            }
            
            if (c.currency === 'coins') { gameState.coins -= c.price; addQuestProgress('spend', c.price); }
            else gameState.gems -= c.price;
            
            gameState.stats.gamesPlayed++;
            addQuestProgress('games');
            
            const reward = Math.floor((Math.random() * (c.max - c.min) + c.min) * getBonus('coins'));
            const gems = Math.random() < c.gemChance ? Math.floor(Math.random() * 3) + 1 : 0;
            
            gameState.coins += reward;
            gameState.stats.totalEarned += reward;
            gameState.gems += gems;
            
            showModal(`${c.icon} ${c.name}`, `+${reward} ü™ô${gems ? ` +${gems} üíé` : ''}`, gems ? 'üíé' : 'ü™ô');
            addXP(id === 'legendary' ? 100 : 25);
        }

        // Prestige
        function doPrestige() {
            if (gameState.level < 20) {
                showToast(`–ù—É–∂–µ–Ω 20 —É—Ä–æ–≤–µ–Ω—å! (—Å–µ–π—á–∞—Å ${gameState.level})`, 'error');
                return;
            }
            
            if (confirm(`–ü—Ä–µ—Å—Ç–∏–∂ —Å–±—Ä–æ—Å–∏—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å, –Ω–æ –¥–∞—Å—Ç +10% –∫–æ –≤—Å–µ–º—É –Ω–∞–≤—Å–µ–≥–¥–∞!\n\n–¢–µ–∫—É—â–∏–π –ø—Ä–µ—Å—Ç–∏–∂: ${gameState.prestige}\n–ù–æ–≤—ã–π –ø—Ä–µ—Å—Ç–∏–∂: ${gameState.prestige + 1}`)) {
                gameState.prestige++;
                const keepGems = gameState.gems;
                const keepPets = gameState.pets;
                const keepStats = { ...gameState.stats };
                const keepPrestige = gameState.prestige;
                const keepAchievements = gameState.achievements;
                
                gameState = JSON.parse(JSON.stringify(DEFAULT_STATE));
                gameState.gems = keepGems + 10;
                gameState.pets = keepPets;
                gameState.stats = keepStats;
                gameState.prestige = keepPrestige;
                gameState.achievements = keepAchievements;
                
                showModal('‚≠ê –ü–†–ï–°–¢–ò–ñ ' + gameState.prestige, `+10% –∫–æ –≤—Å–µ–º—É –Ω–∞–≤—Å–µ–≥–¥–∞!\n+10 üíé`, 'üåü');
                initializeGame();
            }
        }

        // Achievements
        function updateAchievements() {
            const container = document.getElementById('achievementsList');
            container.innerHTML = ACHIEVEMENTS.map(ach => {
                const unlocked = ach.condition(gameState);
                if (unlocked && !gameState.achievements.includes(ach.id)) {
                    gameState.achievements.push(ach.id);
                    setTimeout(() => showToast(`üèÜ ${ach.name}!`, 'success'), 500);
                }
                return `<div class="bg-gray-800/50 rounded-xl p-2 text-center text-xl ${unlocked ? '' : 'opacity-30 grayscale'}" title="${ach.name}">${unlocked ? ach.icon : '‚ùì'}</div>`;
            }).join('');
        }

        // ============ INIT ============
        function initializeGame() {
            updateAllUI();
            renderWork();
            renderShop();
            renderPets();
            renderInvestments();
            renderExpeditions();
            renderCrafts();
            renderCases();
        }

        // Energy regen
        setInterval(() => {
            if (gameState.energy < gameState.maxEnergy) {
                gameState.energy = Math.min(gameState.energy + 1, gameState.maxEnergy);
                gameState.lastEnergyRegen = Date.now();
                updateAllUI();
            }
        }, 6000);

        // Investment income
        setInterval(() => {
            let income = 0;
            for (const [id, count] of Object.entries(gameState.investments)) {
                const inv = INVESTMENTS.find(i => i.id === id);
                if (inv) income += inv.income * count;
            }
            if (income > 0) {
                gameState.coins += income;
                gameState.stats.totalEarned += income;
                updateAllUI();
            }
        }, 60000);

        // Expedition checker
        setInterval(() => {
            const now = Date.now();
            for (const [id, exp] of Object.entries(gameState.expeditions)) {
                if (exp.endTime && now >= exp.endTime) {
                    const expedition = EXPEDITIONS.find(e => e.id === id);
                    for (const [key, val] of Object.entries(expedition.rewards)) {
                        if (key === 'coins') gameState.coins += val;
                        else if (key === 'gems') gameState.gems += val;
                        else if (gameState.ores[key] !== undefined) gameState.ores[key] += val;
                    }
                    showToast(`üó∫Ô∏è ${expedition.name} –∑–∞–≤–µ—Ä—à–µ–Ω–∞!`, 'success');
                    delete gameState.expeditions[id];
                    renderExpeditions();
                    updateAllUI();
                }
            }
        }, 1000);

        // Play time
        setInterval(() => {
            gameState.stats.playTimeMinutes++;
            saveGame();
        }, 60000);

        // Telegram
        function initTelegram() {
            if (window.Telegram?.WebApp) {
                const tg = window.Telegram.WebApp;
                tg.ready();
                tg.expand();
                
                const user = tg.initDataUnsafe?.user;
                if (user) {
                    document.getElementById('playerInitial').textContent = (user.first_name || 'G')[0].toUpperCase();
                    document.getElementById('playerName').textContent = user.first_name || '–ò–≥—Ä–æ–∫';
                }
                
                tg.enableClosingConfirmation();
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadGame();
            initTelegram();
        });

        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'hidden') saveGame();
        });
        
        window.addEventListener('beforeunload', saveGame);
    </script>
</body>
</html>
