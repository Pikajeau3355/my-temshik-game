<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>UA Temshik: Full Edition</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        :root {
            --primary: #6366f1; --primary-glow: rgba(99, 102, 241, 0.4);
            --bg: #030712; --card-bg: rgba(31, 41, 55, 0.5);
            --card-border: rgba(255, 255, 255, 0.08);
            --success: #10b981; --danger: #ef4444; --gold: #f59e0b; --energy: #06b6d4;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; background: var(--bg); color: #f3f4f6; font-family: 'Plus Jakarta Sans', sans-serif; overflow: hidden; height: 100vh; display: flex; flex-direction: column; background-image: radial-gradient(circle at 50% -20%, #1e1b4b 0%, var(--bg) 80%); }
        .bg-glow { position: fixed; inset: 0; z-index: -1; pointer-events: none; background: radial-gradient(circle at 15% 25%, rgba(99, 102, 241, 0.08) 0%, transparent 35%), radial-gradient(circle at 85% 75%, rgba(6, 182, 212, 0.08) 0%, transparent 35%); }
        #notification-container { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 2000; pointer-events: none; width: 85%; }
        .toast { background: rgba(17, 24, 39, 0.95); backdrop-filter: blur(12px); padding: 18px 24px; border-radius: 24px; border: 1px solid var(--primary); font-weight: 800; text-align: center; margin-bottom: 12px; box-shadow: 0 10px 40px var(--primary-glow); animation: toastIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards, toastOut 0.5s 2s forwards; }
        @keyframes toastIn { from { opacity: 0; transform: scale(0.7); } to { opacity: 1; transform: scale(1); } }
        @keyframes toastOut { to { opacity: 0; transform: scale(0.7) translateY(-30px); } }
        .header { padding: 50px 24px 15px; flex-shrink: 0; }
        .user-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .lvl-badge { background: rgba(245, 158, 11, 0.2); color: var(--gold); padding: 4px 12px; border-radius: 10px; font-size: 12px; font-weight: 800; border: 1px solid rgba(245, 158, 11, 0.3); }
        .main-card { background: var(--card-bg); backdrop-filter: blur(16px); border-radius: 30px; padding: 22px; text-align: center; border: 1px solid var(--card-border); box-shadow: 0 15px 35px rgba(0,0,0,0.4); }
        .money-display { font-size: 34px; font-weight: 800; margin: 4px 0; letter-spacing: -1px; }
        .passive-income { font-size: 12px; color: var(--success); font-weight: 700; }
        .progress-box { margin-top: 15px; text-align: left; }
        .progress-info { display: flex; justify-content: space-between; font-size: 10px; font-weight: 800; color: #6b7280; margin-bottom: 6px; }
        .progress-bar { width: 100%; height: 8px; background: rgba(255,255,255,0.05); border-radius: 10px; overflow: hidden; }
        .progress-fill { height: 100%; transition: 0.3s; }
        .viewport { flex: 1; overflow-y: auto; padding: 0 24px 120px; -webkit-overflow-scrolling: touch; }
        .tab { display: none; } .tab.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .section-label { font-size: 11px; font-weight: 800; color: #4b5563; margin: 25px 0 12px; text-transform: uppercase; letter-spacing: 2px; }
        .item { background: var(--card-bg); border-radius: 22px; padding: 18px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--card-border); transition: 0.2s; }
        .item:active { transform: scale(0.98); }
        .item.locked { opacity: 0.3; filter: grayscale(1); pointer-events: none; }
        .item-info b { font-size: 15px; display: block; margin-bottom: 2px; }
        .item-info small { color: #9ca3af; font-size: 11px; }
        .btn { background: linear-gradient(135deg, var(--primary), #4f46e5); color: white; border: none; padding: 12px 18px; border-radius: 14px; font-weight: 800; font-size: 12px; box-shadow: 0 4px 10px var(--primary-glow); }
        .btn:disabled { background: #1f2937; box-shadow: none; color: #4b5563; }
        .nav { position: fixed; bottom: 25px; left: 24px; right: 24px; background: rgba(17, 24, 39, 0.85); backdrop-filter: blur(20px); border-radius: 26px; height: 72px; display: flex; justify-content: space-around; align-items: center; border: 1px solid var(--card-border); z-index: 1000; }
        .nav-link { display: flex; flex-direction: column; align-items: center; color: #6b7280; font-size: 10px; font-weight: 700; gap: 5px; text-decoration: none; }
        .nav-link.active { color: var(--primary); }
        .nav-link i { font-size: 20px; font-style: normal; }
    </style>
</head>
<body>

<div class="bg-glow"></div>
<div id="notification-container"></div>

<div class="header">
    <div class="user-bar">
        <div style="display:flex; align-items:center; gap:10px;">
            <div id="u-avatar" style="width:38px; height:38px; background:var(--primary); border-radius:12px; display:flex; align-items:center; justify-content:center; font-weight:800; box-shadow: 0 5px 15px var(--primary-glow);">?</div>
            <span class="lvl-badge" id="u-lvl">LVL 1</span>
        </div>
        <div id="u-xp" style="font-size:11px; font-weight:800; color:var(--gold);">0 / 1000 XP</div>
    </div>
    <div class="main-card">
        <div class="money-display" id="balance">0 ‚Ç¥</div>
        <div class="passive-income" id="passive-info">+0 ‚Ç¥/—Å</div>
        <div class="progress-box">
            <div class="progress-info"><span>–ï–ù–ï–†–ì–Ü–Ø</span><span id="energy-text">100%</span></div>
            <div class="progress-bar"><div class="progress-fill" id="energy-fill" style="background: var(--energy); box-shadow: 0 0 10px var(--energy);"></div></div>
        </div>
    </div>
</div>

<div class="viewport">
    <div id="tab-work" class="tab active">
        <div class="section-label">–°—Ö–µ–º–∏ –∑–∞—Ä–æ–±—ñ—Ç–∫—É</div>
        <div id="temki-list"></div>
    </div>
    <div id="tab-crypto" class="tab">
        <div class="section-label">–¢—Ä–µ–π–¥–∏–Ω–≥</div>
        <div class="item" style="flex-direction: column; align-items: stretch;">
            <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                <div><b style="font-size:18px;">Bitcoin</b><br><small id="my-btc">0 BTC</small></div>
                <div id="btc-price" style="color:var(--success); font-weight:800; font-size:18px;">‚Ç¥ 0</div>
            </div>
            <canvas id="cryptoChart" style="width:100%; height:90px;"></canvas>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin-top:20px;">
                <button class="btn" onclick="trade('buy')">–ö–£–ü–ò–¢–ò –í–°–ï</button>
                <button class="btn" style="background:#1f2937" onclick="trade('sell')">–ü–†–û–î–ê–¢–ò –í–°–ï</button>
            </div>
        </div>
    </div>
    <div id="tab-shop" class="tab">
        <div class="section-label">–ú–∞–≥–∞–∑–∏–Ω –µ–Ω–µ—Ä–≥—ñ—ó</div>
        <div id="food-list"></div>
        <div class="section-label">–ù–µ—Ä—É—Ö–æ–º—ñ—Å—Ç—å / –ë—ñ–∑–Ω–µ—Å</div>
        <div id="assets-list"></div>
    </div>
    <div id="tab-top" class="tab">
        <div class="section-label">–°–≤—ñ—Ç–æ–≤–∏–π —Ä–µ–π—Ç–∏–Ω–≥</div>
        <div id="leader-list"></div>
    </div>
</div>

<nav class="nav">
    <div class="nav-link active" onclick="showTab('work', this)"><i>üí∞</i>–¢–µ–º–∫–∏</div>
    <div class="nav-link" onclick="showTab('crypto', this)"><i>üìà</i>–ë—ñ—Ä–∂–∞</div>
    <div class="nav-link" onclick="showTab('shop', this)"><i>üè¢</i>–®–æ–ø</div>
    <div class="nav-link" onclick="showTab('top', this)"><i>üèÜ</i>–¢–û–ü</div>
</nav>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    const firebaseConfig = {
        apiKey: "AIzaSyA1m-re7gnHR6zxSoPdy3T0_2jX3IRzgJ4",
        authDomain: "temshiki.firebaseapp.com",
        databaseURL: "https://temshiki-default-rtdb.firebaseio.com",
        projectId: "temshiki",
        storageBucket: "temshiki.firebasestorage.app",
        messagingSenderId: "806405354510",
        appId: "1:806405354510:web:828cb6aae403df3cc0f85f"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let money = Number(localStorage.getItem('money')) || 5000;
    let btc = Number(localStorage.getItem('btc')) || 0;
    let energy = Number(localStorage.getItem('energy')) || 100;
    let xp = Number(localStorage.getItem('xp')) || 0;
    let myAssets = JSON.parse(localStorage.getItem('myAssets')) || { bot: 0, farm: 0, office: 0 };
    let btcPrice = 3800000;
    let priceHistory = Array.from({length:15}, () => 3800000);

    const temkiList = [
        ["–î—Ä–æ–ø —á–æ—Ö–ª—ñ–≤", 1, 10, 200, 600, 0.05, 50],
        ["–†–µ—Å–µ–π–ª –∫—Ä–æ—Å", 2, 15, 800, 2000, 0.07, 100],
        ["–ü—Ä–æ–¥–∞–∂ iPhone", 3, 20, 2500, 5500, 0.1, 160],
        ["–¢—Ä–∞—Ñ—ñ–∫ FB", 4, 28, 5000, 13000, 0.15, 350],
        ["P2P –û–±–º—ñ–Ω", 5, 35, 9000, 25000, 0.2, 600],
        ["–ù–∞–∫—Ä—É—Ç–∫–∞ –¢–¢", 6, 12, 600, 1600, 0.04, 70],
        ["–ê–∫–∫–∞—É–Ω—Ç–∏ —ñ–≥–æ—Ä", 7, 18, 1400, 3800, 0.12, 120],
        ["–°–∫—ñ–Ω–∏ CS2", 8, 22, 2800, 7500, 0.14, 200],
        ["–î–∏–∑–∞–π–Ω –ª–æ–≥–æ", 9, 14, 1000, 3000, 0.06, 90],
        ["–ü—Ä–æ–¥–∞–∂ –∫—É—Ä—Å—ñ–≤", 10, 30, 7000, 20000, 0.18, 500],
        ["–ü–µ—Ä–µ–≥–æ–Ω –∞–≤—Ç–æ", 11, 45, 18000, 50000, 0.22, 1300],
        ["Whitelist NFT", 12, 38, 12000, 35000, 0.25, 950],
        ["–ú–∞–π–Ω—ñ–Ω–≥ —Ö–æ—Å—Ç", 13, 34, 10000, 28000, 0.15, 850],
        ["–°–ª–æ—Ç-–∫–∞–∑–∏–Ω–æ", 14, 50, 25000, 75000, 0.35, 2200],
        ["IT –¢–µ–Ω–¥–µ—Ä–∏", 15, 55, 50000, 140000, 0.38, 4000],
        ["–ó–∞–ø—á–∞—Å—Ç–∏–Ω–∏", 16, 22, 3500, 10000, 0.1, 300],
        ["–î–∞—Ä–∫–Ω–µ—Ç —Å—É–ø–æ—Ä—Ç", 17, 65, 60000, 180000, 0.48, 5500],
        ["–ï–∫—Å–ø–æ—Ä—Ç –ª—ñ—Å—É", 18, 60, 120000, 350000, 0.42, 9000],
        ["–•–µ–¥–∂-—Ñ–æ–Ω–¥", 19, 70, 200000, 600000, 0.52, 14000],
        ["IDO –ü—Ä–æ–µ–∫—Ç", 20, 75, 250000, 800000, 0.58, 20000],
        ["–ù–∞—Ñ—Ç–æ–≤–∞ –≤–µ–∂–∞", 21, 80, 400000, 1200000, 0.62, 30000],
        ["–ó–∞–±—É–¥–æ–≤–∞ –ñ–ö", 22, 85, 600000, 2500000, 0.68, 50000],
        ["–ë–∞–Ω–∫ –£–∫—Ä–∞—ó–Ω–∏", 23, 90, 1200000, 6000000, 0.72, 80000],
        ["–õ–æ–±—ñ—é–≤–∞–Ω–Ω—è", 24, 95, 2500000, 12000000, 0.78, 150000],
        ["–ü—Ä–µ–∑–∏–¥–µ–Ω—Ç", 25, 100, 6000000, 30000000, 0.85, 400000]
    ];

    function showToast(txt, clr = 'var(--primary)') {
        const c = document.getElementById('notification-container');
        const t = document.createElement('div');
        t.className = 'toast'; t.style.borderColor = clr; t.textContent = txt;
        c.appendChild(t); setTimeout(() => t.remove(), 2500);
    }

    function updateUI() {
        const lvl = Math.floor(xp / 1000) + 1;
        document.getElementById('balance').textContent = Math.floor(money).toLocaleString() + ' ‚Ç¥';
        document.getElementById('energy-fill').style.width = energy + '%';
        document.getElementById('energy-text').textContent = Math.floor(energy) + '%';
        document.getElementById('u-lvl').textContent = `LVL ${lvl}`;
        document.getElementById('u-xp').textContent = `${xp} / ${lvl * 1000} XP`;
        document.getElementById('u-avatar').textContent = (tg.initDataUnsafe?.user?.first_name || "T")[0];
        document.getElementById('my-btc').textContent = btc.toFixed(4) + ' BTC';
        document.getElementById('btc-price').textContent = '‚Ç¥ ' + Math.floor(btcPrice).toLocaleString();
        
        const pass = (myAssets.bot*25) + (myAssets.farm*300) + (myAssets.office*5500);
        document.getElementById('passive-info').textContent = `+${pass.toLocaleString()} ‚Ç¥ / —Å–µ–∫`;
        
        renderAll(lvl);
        save(lvl);
    }

    function renderAll(lvl) {
        let h = '';
        temkiList.forEach((t, i) => {
            const lock = lvl < t[1];
            h += `<div class="item ${lock?'locked':''}">
                <div class="item-info"><b>${lock?'üîí –†—ñ–≤–µ–Ω—å '+t[1] : t[0]}</b><small>${lock?'–ë–ª–æ–∫–æ–≤–∞–Ω–æ':t[3].toLocaleString()+'+ ‚Ç¥ | -'+t[2]+'‚ö°'}</small></div>
                <button class="btn" onclick="execTemka(${i})" ${lock||energy<t[2]?'disabled':''}>–ú–£–¢–ò–¢–ò</button>
            </div>`;
        });
        document.getElementById('temki-list').innerHTML = h;

        let bH = '';
        [{id:'bot',n:'–¢–ì –ë–æ—Ç',c:20000,i:25},{id:'farm',n:'–ö—Ä–∏–ø—Ç–æ—Ñ–µ—Ä–º–∞',c:250000,i:300},{id:'office',n:'–û—Ñ—ñ—Å',c:5000000,i:5500}].forEach(b => {
            bH += `<div class="item">
                <div class="item-info"><b>${b.n} (${myAssets[b.id]})</b><small>${b.c.toLocaleString()} ‚Ç¥ | +${b.i}/—Å</small></div>
                <button class="btn" onclick="buyAsset('${b.id}',${b.c})" ${money<b.c?'disabled':''}>–ö–£–ü–ò–¢–ò</button>
            </div>`;
        });
        document.getElementById('assets-list').innerHTML = bH;

        let fH = '';
        [{n:"–ï–Ω–µ—Ä–≥–µ—Ç–∏–∫",c:300,e:30},{n:"–®–∞—É—Ä–º–∞",c:800,e:65},{n:"–†–µ—Å—Ç–æ—Ä–∞–Ω",c:2500,e:100}].forEach(f => {
            fH += `<div class="item">
                <div class="item-info"><b>${f.n}</b><small>${f.c} ‚Ç¥ | +${f.e}‚ö°</small></div>
                <button class="btn" onclick="buyFood(${f.c},${f.e})" ${money<f.c||energy>=100?'disabled':''}>–ö–£–ü–ò–¢–ò</button>
            </div>`;
        });
        document.getElementById('food-list').innerHTML = fH;
    }

    function execTemka(i) {
        const t = temkiList[i];
        if(energy >= t[2]) {
            energy -= t[2];
            if(Math.random() > t[5]) {
                const p = Math.floor(Math.random()*(t[4]-t[3]+1))+t[3];
                money += p; xp += t[6];
                showToast(`‚úÖ +${p} ‚Ç¥`, 'var(--success)');
                tg.HapticFeedback.impactOccurred('medium');
            } else {
                const l = Math.floor(t[3] * 1.5);
                money = Math.max(0, money - l);
                showToast(`‚ùå –û–±–ª–∞–≤–∞! -${l} ‚Ç¥`, 'var(--danger)');
                tg.HapticFeedback.notificationOccurred('error');
            }
            updateUI();
        }
    }

    function buyFood(c,e) { if(money>=c && energy<100) { money-=c; energy=Math.min(100, energy+e); updateUI(); } }
    function buyAsset(id,c) { if(money>=c) { money-=c; myAssets[id]++; updateUI(); } }
    
    function trade(type) {
        if(type==='buy' && money > 100) { btc += money / btcPrice; money = 0; }
        else if(type==='sell' && btc > 0) { money += btc * btcPrice; btc = 0; }
        updateUI();
    }

    function showTab(n, el) {
        document.querySelectorAll('.tab').forEach(x => x.classList.remove('active'));
        document.querySelectorAll('.nav-link').forEach(x => x.classList.remove('active'));
        document.getElementById('tab-'+n).classList.add('active'); 
        if(el) el.classList.add('active');
        if(n==='top') loadTop();
        if(n==='crypto') setTimeout(drawChart, 100);
    }

    function save(lvl) {
        const netWorth = Math.floor(money + (btc * btcPrice));
        localStorage.setItem('money', money); 
        localStorage.setItem('btc', btc);
        localStorage.setItem('energy', energy); 
        localStorage.setItem('xp', xp);
        localStorage.setItem('myAssets', JSON.stringify(myAssets));
        
        const uid = String(tg.initDataUnsafe?.user?.id || "dev_user");
        db.ref('users/' + uid).update({
            name: tg.initDataUnsafe?.user?.first_name || "–¢–µ–º—â–∏–∫",
            balance: netWorth, 
            lvl: lvl
        });
    }

    function loadTop() {
        const container = document.getElementById('leader-list');
        container.innerHTML = '<div style="text-align:center;padding:20px;color:#6b7280;">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>';
        
        db.ref('users').orderByChild('balance').limitToLast(10).once('value').then(s => {
            let p = [];
            s.forEach(c => { p.push({id: c.key, ...c.val()}); });
            p.sort((a,b) => b.balance - a.balance);
            
            let h = '';
            const myUid = String(tg.initDataUnsafe?.user?.id || "dev_user");
            p.forEach((x, i) => {
                const isMe = x.id === myUid;
                h += `<div class="item" style="${isMe?'border:1px solid var(--primary); background:rgba(99,102,241,0.05)':''}">
                    <div style="display:flex; align-items:center; gap:10px;">
                        <b style="color:${i<3?'var(--gold)':'#4b5563'}">#${i+1}</b>
                        <b>${x.name}</b>
                    </div>
                    <span style="color:var(--success); font-weight:800;">${Math.floor(x.balance).toLocaleString()} ‚Ç¥</span>
                </div>`;
            });
            container.innerHTML = h || '<div style="text-align:center;padding:20px;">–ü–æ–∫–∏ –Ω—ñ–∫–æ–≥–æ...</div>';
        }).catch(() => {
            container.innerHTML = '<div style="text-align:center;padding:20px;color:var(--danger);">–ü–æ–º–∏–ª–∫–∞. –ü–µ—Ä–µ–≤—ñ—Ä Rules —É Firebase!</div>';
        });
    }

    function drawChart() {
        const c = document.getElementById('cryptoChart'); const ctx = c.getContext('2d');
        c.width = c.offsetWidth; c.height = 90;
        ctx.beginPath(); ctx.strokeStyle = '#6366f1'; ctx.lineWidth = 4; ctx.lineJoin = 'round';
        priceHistory.forEach((p, i) => {
            let x = (i/(priceHistory.length-1))*c.width;
            let y = c.height - ((p-3000000)/1500000)*c.height;
            if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
        });
        ctx.stroke();
    }

    setInterval(() => {
        btcPrice += (Math.random()-0.5)*120000;
        priceHistory.push(btcPrice); if(priceHistory.length>15) priceHistory.shift();
        energy = Math.min(100, energy + 1.2);
        money += (myAssets.bot*25 + myAssets.farm*300 + myAssets.office*5500)/10;
        updateUI();
    }, 3000);

    updateUI();
</script>
</body>
</html>
